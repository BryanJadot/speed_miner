from json import loads
from unittest.mock import call, MagicMock, patch

from speed_miner.mining_groups.zpool_mining_group import ZPoolMiningGroup, ZPoolMiningGroupLoader
from speed_miner.miner import MinerConfigLoader
from speed_miner.misc.config_loader import MiningConfigManager

from tests.util.test_case import MinerTestCase


class TestMinerConfigLoader(MinerTestCase):

    def setUp(self):
        self.c = ZPoolMiningGroupLoader()

    def test_good_dict_parse(self):
        d = {
            "payout_currency": "btc",
            "algo_blacklist": "skein, equihash",
            "algo_data_source": "currency",
            "calc_all_algo_data_sources": "true",
        }
        config = self.c.process_config_from_dict(d)
        self.assertEqual(config["payout_currency"], "BTC")
        self.assertEqual(config["algo_blacklist"], {"skein", "equihash"})
        self.assertEqual(config["algo_data_source"], "currency")
        self.assertEqual(config["calc_all_algo_data_sources"], True)

        d = {
            "payout_currency": "btc",
        }
        config = self.c.process_config_from_dict(d)
        self.assertEqual(config["payout_currency"], "BTC")
        self.assertEqual(config["algo_blacklist"], set())
        self.assertEqual(config["algo_data_source"], "algo")
        self.assertEqual(config["calc_all_algo_data_sources"], False)

    def _check_desc(self, _exit, _print):
        _exit.assert_called_with(1)
        desc = _print.call_args[0][0]
        self.assertIn("Looks like you're trying", desc)
        self.assertIn("A list of algos to not mine", desc)
        self.assertIn("Put the desired", desc)
        self.assertIn("profitability from all", desc)
        self.assertIn("default: \"algo\"", desc)
        self.assertIn("default: \"\"", desc)
        self.assertIn("default: \"false\"", desc)

    @patch("speed_miner.misc.config_loader.print")
    @patch("speed_miner.misc.config_loader.exit")
    def test_bad_param(self, _exit, _print):
        d = {
            "payout_currency": "btc",
            "algo_blacklist": "skein, equihash",
            "algo_data_source": "currencfdsay",
        }
        self.c.process_config_from_dict(d)
        self._check_desc(_exit, _print)


class TestZPoolMiningGroup(MinerTestCase):

    def test_get_group_config_loader(self):
        self.assertTrue(isinstance(
            ZPoolMiningGroup.get_group_config_loader(), ZPoolMiningGroupLoader))

    def test_init_from_config(self):
        d = {
            "wallet": "fdsa",
            "payout_currency": "btc",
            "group": "zpool",
        }
        config_man = MiningConfigManager()

        main_config_loader = MinerConfigLoader()
        config_man.load_from_dict(main_config_loader, d)

        group_config_loader = ZPoolMiningGroupLoader()
        config_man.load_from_dict(group_config_loader, d)

        config = config_man.get_config()

        self.assertTrue(isinstance(ZPoolMiningGroup.init_from_config(config), ZPoolMiningGroup))

    def _get_currency_api_resp(self):
        return loads('{"4CHN":{"algo":"scrypt","port":3433,"name":"Chan","height":22284,"workers":2012,"shares":49,"hashrate":0,"estimate":"1.12796","24h_blocks":0,"24h_btc":0,"lastblock":22200,"timesincelast":382813}, "ABY":{"algo":"scrypt","port":3433,"name":"ArtByte","height":956619,"workers":2012,"shares":603,"hashrate":12937095484,"estimate":"2.02888","24h_blocks":18,"24h_btc":0.01341719,"lastblock":956553,"timesincelast":5003}, "ACC":{"algo":"scrypt","port":3433,"name":"Adcoin","height":16648,"workers":2012,"shares":49,"hashrate":0,"estimate":"1.35096","24h_blocks":0,"24h_btc":0,"lastblock":13631,"timesincelast":650411}, "ACOIN":{"algo":"sha256","port":3333,"name":"A","height":3877220,"workers":1034,"shares":90,"hashrate":0,"estimate":"54.18009","24h_blocks":2,"24h_btc":1.02e-6,"lastblock":3877113,"timesincelast":3431}, "ADZ":{"algo":"x11","port":3533,"name":"Adz","height":402418,"workers":1902,"shares":244,"hashrate":0,"estimate":"0.02041","24h_blocks":15,"24h_btc":0.00388269,"lastblock":402393,"timesincelast":50380}, "ALEX":{"algo":"sha256","port":3333,"name":"Alexandrite","height":232223,"workers":1034,"shares":90,"hashrate":0,"estimate":"137.75539","24h_blocks":162,"24h_btc":0.00218645,"lastblock":232212,"timesincelast":1500}, "ALL":{"algo":"scrypt","port":3433,"name":"Allion","height":439803,"workers":2013,"shares":49,"hashrate":0,"estimate":"1.32859","24h_blocks":0,"24h_btc":0,"lastblock":439588,"timesincelast":170962}, "ALTCOM":{"algo":"skunk","port":8433,"name":"AltCom","height":168720,"workers":66,"shares":1549,"hashrate":4572824879,"estimate":"0.01211","24h_blocks":169,"24h_btc":0.09301223,"lastblock":168711,"timesincelast":1145}, "APC":{"algo":"sha256","port":3333,"name":"Alpa","height":115783,"workers":1034,"shares":90,"hashrate":0,"estimate":"4.91385","24h_blocks":0,"24h_btc":0,"lastblock":115574,"timesincelast":2300912}, "ARC":{"algo":"x11","port":3533,"name":"Arctic","height":273317,"workers":1902,"shares":244,"hashrate":0,"estimate":"0.02073","24h_blocks":0,"24h_btc":0,"lastblock":252907,"timesincelast":3215058}, "ARG":{"algo":"scrypt","port":3433,"name":"Argentum","height":2856867,"workers":2014,"shares":49,"hashrate":0,"estimate":"0.00085","24h_blocks":23,"24h_btc":2.079e-5,"lastblock":2856788,"timesincelast":4632}, "ARG-sha":{"algo":"sha256","port":3333,"name":"Argentum","height":2856867,"workers":1034,"shares":90,"hashrate":0,"estimate":"3.82088","24h_blocks":605,"24h_btc":0.00114347,"lastblock":2856861,"timesincelast":819,"symbol":"ARG"}, "AUR":{"algo":"scrypt","port":3433,"name":"Aurora","height":1186131,"workers":2014,"shares":49,"hashrate":0,"estimate":"1.52599","24h_blocks":17,"24h_btc":0.00502007,"lastblock":1186083,"timesincelast":4947}, "AUR-groestl":{"algo":"myr-gr","port":5433,"name":"Aurora","height":1186131,"workers":20,"shares":1070,"hashrate":433943874573,"estimate":"0.00019","24h_blocks":28,"24h_btc":0.00822373,"lastblock":1186113,"timesincelast":4381,"symbol":"AUR"}, "AUR-skein":{"algo":"skein","port":4933,"name":"Aurora","height":1186131,"workers":202,"shares":19,"hashrate":0,"estimate":"0.00051","24h_blocks":54,"24h_btc":0.01613857,"lastblock":1186129,"timesincelast":1145,"symbol":"AUR"}, "BCH":{"algo":"sha256","port":3333,"name":"BitCash","height":512357,"workers":1037,"shares":90,"hashrate":0,"estimate":"165.58980","24h_blocks":0,"24h_btc":0,"lastblock":0,"timesincelast":0}, "BDL":{"algo":"scrypt","port":3433,"name":"Bitdeal","height":71769,"workers":2014,"shares":49,"hashrate":0,"estimate":"0.55134","24h_blocks":0,"24h_btc":0,"lastblock":70799,"timesincelast":2921372}, "BELA":{"algo":"scrypt","port":3433,"name":"Bela","height":846962,"workers":2014,"shares":49,"hashrate":0,"estimate":"0.15582","24h_blocks":0,"24h_btc":0,"lastblock":845997,"timesincelast":116437}, "BENJI":{"algo":"scrypt","port":3433,"name":"BenjiRolls","height":246319,"workers":2014,"shares":49,"hashrate":0,"estimate":"1.51774","24h_blocks":0,"24h_btc":0,"lastblock":239452,"timesincelast":2468072}, "BERN":{"algo":"x14","port":3933,"name":"Bern","height":1416000,"workers":53,"shares":403,"hashrate":8828961090,"estimate":"0.00102","24h_blocks":427,"24h_btc":0.01218486,"lastblock":1415992,"timesincelast":1068}, "BLC":{"algo":"blakecoin","port":5743,"name":"Blake","height":670144,"workers":14,"shares":110,"hashrate":87872969292,"estimate":"0.06896","24h_blocks":25,"24h_btc":0.00262597,"lastblock":670136,"timesincelast":2887}, "BOLI":{"algo":"x11","port":3533,"name":"Bolivar","height":349420,"workers":1902,"shares":244,"hashrate":0,"estimate":"0.00438","24h_blocks":67,"24h_btc":0.01008585,"lastblock":349411,"timesincelast":41355}, "BSD":{"algo":"xevan","port":3739,"name":"BitSend","height":420856,"workers":161,"shares":2813,"hashrate":274584176,"estimate":"0.08736","24h_blocks":53,"24h_btc":0.02494324,"lastblock":420853,"timesincelast":1016}, "BSTY":{"algo":"yescrypt","port":6233,"name":"GlobalBoost","height":166695,"workers":17915,"shares":890,"hashrate":73744,"estimate":"0.01498","24h_blocks":102,"24h_btc":0.02169178,"lastblock":166695,"timesincelast":762}, "BTB":{"algo":"scrypt","port":3433,"name":"BitBar","height":257976,"workers":2014,"shares":1672,"hashrate":36841587508,"estimate":"2.84473","24h_blocks":47,"24h_btc":0.0122015,"lastblock":257976,"timesincelast":866}, "BTX":{"algo":"bitcore","port":3556,"name":"BitCore","height":115530,"workers":18,"shares":30211,"hashrate":258738205,"estimate":"0.02684","24h_blocks":0,"24h_btc":0,"lastblock":112873,"timesincelast":415664}, "BUCKS":{"algo":"scrypt","port":3433,"name":"SwagBucks","height":339371,"workers":2014,"shares":125,"hashrate":1258123788,"estimate":"1.64197","24h_blocks":14,"24h_btc":0.00315537,"lastblock":339188,"timesincelast":15941}, "BWK":{"algo":"nist5","port":3833,"name":"Bulwark","height":36417,"workers":1131,"shares":39456,"hashrate":99253545026,"estimate":"0.00990","24h_blocks":27,"24h_btc":0.80507673,"lastblock":36395,"timesincelast":2585}, "CANN":{"algo":"x11","port":3533,"name":"Cannabis","height":2647287,"workers":1973,"shares":6163,"hashrate":4909523042083,"estimate":"0.02707","24h_blocks":195,"24h_btc":0.23320495,"lastblock":2647220,"timesincelast":3002}, "CAT":{"algo":"scrypt","port":3433,"name":"Cat","height":125320,"workers":2014,"shares":49,"hashrate":0,"estimate":"1.40383","24h_blocks":0,"24h_btc":0,"lastblock":125298,"timesincelast":103551}, "CESC":{"algo":"scrypt","port":3433,"name":"CryptoEscudo","height":982201,"workers":2014,"shares":49,"hashrate":0,"estimate":"0.15582","24h_blocks":0,"24h_btc":0,"lastblock":968413,"timesincelast":1629703}, "CHC":{"algo":"c11","port":3573,"name":"Chain","height":1356857,"workers":84,"shares":2373,"hashrate":2452380055,"estimate":"0.02080","24h_blocks":181,"24h_btc":0.06153963,"lastblock":1356850,"timesincelast":1278}, "CJ":{"algo":"x13","port":3633,"name":"CryptoJacks","height":1530002,"workers":82,"shares":152,"hashrate":1144611991,"estimate":"0.00077","24h_blocks":48,"24h_btc":0.00053039,"lastblock":1529992,"timesincelast":879}, "CMPCO":{"algo":"scrypt","port":3433,"name":"Campus","height":225086,"workers":2027,"shares":49,"hashrate":0,"estimate":"2.38307","24h_blocks":150,"24h_btc":0.17153671,"lastblock":225079,"timesincelast":1001}, "CNO":{"algo":"x11","port":3533,"name":"Coino","height":63746,"workers":1903,"shares":244,"hashrate":0,"estimate":"0.00289","24h_blocks":0,"24h_btc":0,"lastblock":62669,"timesincelast":257640}, "COPPER":{"algo":"scrypt","port":3433,"name":"Copper","height":151857,"workers":2017,"shares":2235,"hashrate":48477948843,"estimate":"3.62887","24h_blocks":189,"24h_btc":0.0391606,"lastblock":151838,"timesincelast":3272}, "CPN":{"algo":"scrypt","port":3433,"name":"Compu","height":1683441,"workers":2014,"shares":49,"hashrate":0,"estimate":"1.95103","24h_blocks":0,"24h_btc":0,"lastblock":1683416,"timesincelast":88520}, "CRC":{"algo":"neoscrypt","port":4233,"name":"Crowd","height":29121,"workers":3730,"shares":22638,"hashrate":4340850790,"estimate":"0.41898","24h_blocks":58,"24h_btc":1.09422568,"lastblock":29118,"timesincelast":965}, "CRM":{"algo":"x11","port":3533,"name":"Cream","height":115078,"workers":1903,"shares":502,"hashrate":156169394145,"estimate":"0.02673","24h_blocks":13,"24h_btc":0.00074945,"lastblock":115061,"timesincelast":3304}, "CRW":{"algo":"sha256","port":3333,"name":"Crown","height":1704451,"workers":1002,"shares":90,"hashrate":0,"estimate":"1.00477","24h_blocks":2,"24h_btc":0.00087124,"lastblock":1704133,"timesincelast":20015}, "DASH":{"algo":"x11","port":3533,"name":"Dash","height":802019,"workers":2362,"shares":22662,"hashrate":18278783089634,"estimate":"0.03127","24h_blocks":3,"24h_btc":0.37952535,"lastblock":801873,"timesincelast":23375}, "DFS":{"algo":"scrypt","port":3433,"name":"Dfs","height":364208,"workers":2016,"shares":2023,"hashrate":52381215293,"estimate":"2.41219","24h_blocks":383,"24h_btc":0.14169141,"lastblock":364119,"timesincelast":5655}, "DGB":{"algo":"qubit","port":4733,"name":"Digibyte","height":5883600,"workers":220,"shares":5825,"hashrate":162629990698,"estimate":"1.08755","24h_blocks":24,"24h_btc":0.13540997,"lastblock":5883521,"timesincelast":2089}, "DGB-Groestl":{"algo":"myr-gr","port":5433,"name":"Digibyte","height":5883600,"workers":20,"shares":90,"hashrate":26349160205,"estimate":"0.00046","24h_blocks":3,"24h_btc":0.01610409,"lastblock":5882979,"timesincelast":10136,"symbol":"DGB"}, "DGB-Scrypt":{"algo":"scrypt","port":3433,"name":"Digibyte","height":5883600,"workers":2016,"shares":12188,"hashrate":300110568449,"estimate":"3.46860","24h_blocks":21,"24h_btc":0.1175693,"lastblock":5883584,"timesincelast":888,"symbol":"DGB"}, "DGB-sha":{"algo":"sha256","port":3333,"name":"Digibyte","height":5883657,"workers":1002,"shares":7275,"hashrate":3.8990653338296e+15,"estimate":"162.29499","24h_blocks":75,"24h_btc":0.40139415,"lastblock":5883496,"timesincelast":2306,"symbol":"DGB"}, "DGB-skein":{"algo":"skein","port":4933,"name":"Digibyte","height":5883602,"workers":200,"shares":6571,"hashrate":242973214579,"estimate":"0.00092","24h_blocks":33,"24h_btc":0.18158101,"lastblock":5883506,"timesincelast":2215,"symbol":"DGB"}, "DGC":{"algo":"x11","port":3533,"name":"Digital","height":3003966,"workers":1904,"shares":244,"hashrate":0,"estimate":"0.02448","24h_blocks":120,"24h_btc":0.00434221,"lastblock":3003943,"timesincelast":3319}, "DGC-Scrypt":{"algo":"scrypt","port":3433,"name":"Digital","height":3003974,"workers":1871,"shares":156,"hashrate":2001369329,"estimate":"1.91948","24h_blocks":26,"24h_btc":0.00095037,"lastblock":3003964,"timesincelast":882,"symbol":"DGC"}, "DGC-sha":{"algo":"sha256","port":3333,"name":"Digital","height":3003966,"workers":1011,"shares":131,"hashrate":15450520855574,"estimate":"30.18700","24h_blocks":97,"24h_btc":0.00353733,"lastblock":3003931,"timesincelast":3485,"symbol":"DGC"}, "DNR":{"algo":"tribus","port":8533,"name":"Denarius","height":499627,"workers":759,"shares":7205,"hashrate":3213725886,"estimate":"0.02764","24h_blocks":193,"24h_btc":0.12096206,"lastblock":499588,"timesincelast":2247}, "DOGE":{"algo":"scrypt","port":3433,"name":"Doge","height":2048280,"workers":1886,"shares":49,"hashrate":0,"estimate":"0.13585","24h_blocks":4,"24h_btc":0.0328187,"lastblock":2047962,"timesincelast":19437}, "EBG":{"algo":"sha256","port":3333,"name":"Embargo","height":72318,"workers":1021,"shares":90,"hashrate":0,"estimate":"56.04369","24h_blocks":0,"24h_btc":0,"lastblock":72317,"timesincelast":256807}, "EDDIE":{"algo":"scrypt","port":3433,"name":"Eddie","height":61866,"workers":1871,"shares":49,"hashrate":0,"estimate":"1.52850","24h_blocks":1,"24h_btc":0.00014028,"lastblock":61632,"timesincelast":45216}, "EFL":{"algo":"scrypt","port":3433,"name":"eGulden","height":1025883,"workers":1872,"shares":372,"hashrate":5819641057,"estimate":"2.88353","24h_blocks":129,"24h_btc":0.00634227,"lastblock":1025874,"timesincelast":820}, "ELM":{"algo":"x11","port":3533,"name":"Elements","height":31786,"workers":1903,"shares":244,"hashrate":0,"estimate":"0.02088","24h_blocks":1,"24h_btc":0.00021316,"lastblock":31782,"timesincelast":18425}, "EMD":{"algo":"scrypt","port":3433,"name":"Emerald","height":6321718,"workers":1871,"shares":49,"hashrate":0,"estimate":"0.98604","24h_blocks":45,"24h_btc":1.586e-5,"lastblock":6318919,"timesincelast":59135}, "ERY":{"algo":"x11","port":3533,"name":"Eryllium","height":114990,"workers":1903,"shares":244,"hashrate":0,"estimate":"0.02442","24h_blocks":6,"24h_btc":0.00408929,"lastblock":114951,"timesincelast":7167}, "EVO":{"algo":"sha256","port":3333,"name":"Evotion","height":1391252,"workers":1033,"shares":94,"hashrate":799563510026,"estimate":"149.77073","24h_blocks":387,"24h_btc":0.00330846,"lastblock":1391252,"timesincelast":1280}, "FIDGT":{"algo":"x11","port":3533,"name":"Fidget","height":644751,"workers":1903,"shares":343,"hashrate":29709944101,"estimate":"0.03106","24h_blocks":812,"24h_btc":0.00063714,"lastblock":644745,"timesincelast":756}, "FLAX":{"algo":"c11","port":3573,"name":"Flaxscript","height":567347,"workers":83,"shares":13,"hashrate":0,"estimate":"0.00420","24h_blocks":30,"24h_btc":7.27e-5,"lastblock":567329,"timesincelast":29553}, "FLO":{"algo":"scrypt","port":3433,"name":"Florin","height":2538459,"workers":1871,"shares":674,"hashrate":11886541349,"estimate":"2.08931","24h_blocks":22,"24h_btc":0.00491829,"lastblock":2538162,"timesincelast":13421}, "FRN":{"algo":"scrypt","port":3433,"name":"Francs","height":206467,"workers":1871,"shares":49,"hashrate":0,"estimate":"2.06378","24h_blocks":0,"24h_btc":0,"lastblock":206149,"timesincelast":102556}, "FTC":{"algo":"neoscrypt","port":4233,"name":"Feather","height":2042067,"workers":3677,"shares":859,"hashrate":125426404,"estimate":"0.20611","24h_blocks":56,"24h_btc":0.07264161,"lastblock":2042040,"timesincelast":1921}, "GAME":{"algo":"scrypt","port":3433,"name":"GameCredits","height":1882720,"workers":1871,"shares":49,"hashrate":0,"estimate":"2.15440","24h_blocks":10,"24h_btc":0.04629203,"lastblock":1882510,"timesincelast":21084}, "GBX":{"algo":"neoscrypt","port":4233,"name":"GoByte","height":29624,"workers":3793,"shares":10632,"hashrate":1492514156,"estimate":"0.40747","24h_blocks":46,"24h_btc":0.8556063,"lastblock":29616,"timesincelast":1473}, "GEERT":{"algo":"scrypt","port":3433,"name":"Geert","height":71635,"workers":1871,"shares":49,"hashrate":0,"estimate":"0.81876","24h_blocks":1,"24h_btc":0.00011788,"lastblock":71260,"timesincelast":75778}, "GEO":{"algo":"qubit","port":4733,"name":"Geo","height":1545337,"workers":211,"shares":5,"hashrate":0,"estimate":"0.56279","24h_blocks":69,"24h_btc":0.04235265,"lastblock":1545332,"timesincelast":1129}, "GRS":{"algo":"groestl","port":5333,"name":"Groestl","height":1916336,"workers":23,"shares":40354,"hashrate":162506822,"estimate":"0.00464","24h_blocks":0,"24h_btc":0,"lastblock":1914114,"timesincelast":140798}, "GUN":{"algo":"neoscrypt","port":4233,"name":"Gun","height":829031,"workers":3672,"shares":58,"hashrate":7306467,"estimate":"0.10435","24h_blocks":75,"24h_btc":0.01502775,"lastblock":829007,"timesincelast":3347}, "HAL":{"algo":"neoscrypt","port":4233,"name":"Halcyon","height":984925,"workers":3866,"shares":62,"hashrate":2878981,"estimate":"0.33578","24h_blocks":34,"24h_btc":0.00479836,"lastblock":984779,"timesincelast":7448}, "HBC":{"algo":"x11","port":3533,"name":"Homeblock","height":17348,"workers":1906,"shares":244,"hashrate":0,"estimate":"0.02531","24h_blocks":46,"24h_btc":0.17339744,"lastblock":17340,"timesincelast":2628}, "HOLD":{"algo":"scrypt","port":3433,"name":"Interstellar","height":42283,"workers":1871,"shares":136,"hashrate":1526264738,"estimate":"2.59734","24h_blocks":66,"24h_btc":0.03063227,"lastblock":42278,"timesincelast":1358}, "HPC":{"algo":"x11","port":3533,"name":"Happy","height":81364,"workers":1904,"shares":244,"hashrate":0,"estimate":"0.02250","24h_blocks":14,"24h_btc":0.01187422,"lastblock":81308,"timesincelast":8475}, "HSR":{"algo":"hsr","port":7433,"name":"Hshare","height":406664,"workers":7,"shares":8960,"hashrate":59051104,"estimate":"0.02410","24h_blocks":1,"24h_btc":0.0020481,"lastblock":404552,"timesincelast":72295}, "HUSH":{"algo":"equihash","port":2142,"name":"Hush","height":237598,"workers":487,"shares":9116,"hashrate":201718,"estimate":"0.65751","24h_blocks":12,"24h_btc":0.11670405,"lastblock":237588,"timesincelast":2798}, "I0C":{"algo":"sha256","port":3333,"name":"I0","height":2347769,"workers":1034,"shares":91,"hashrate":0,"estimate":"0.00018","24h_blocks":1,"24h_btc":3.7e-7,"lastblock":2347252,"timesincelast":45813}, "IN":{"algo":"x11","port":3533,"name":"In","height":60140,"workers":1903,"shares":244,"hashrate":0,"estimate":"0.01885","24h_blocks":0,"24h_btc":0,"lastblock":59653,"timesincelast":266217}, "INFX":{"algo":"x11","port":3533,"name":"Influx","height":458455,"workers":1910,"shares":244,"hashrate":0,"estimate":"0.02533","24h_blocks":19,"24h_btc":0.00882328,"lastblock":458368,"timesincelast":11704}, "INN":{"algo":"neoscrypt","port":4233,"name":"Innova","height":56245,"workers":3785,"shares":36,"hashrate":0,"estimate":"0.22728","24h_blocks":88,"24h_btc":0.55224002,"lastblock":56235,"timesincelast":2396}, "IRL":{"algo":"scrypt","port":3433,"name":"Irish","height":381749,"workers":1899,"shares":49,"hashrate":0,"estimate":"1.49027","24h_blocks":25,"24h_btc":0.00489765,"lastblock":381747,"timesincelast":54601}, "KASH":{"algo":"x11","port":3533,"name":"Kash","height":27944,"workers":1904,"shares":244,"hashrate":0,"estimate":"0.02348","24h_blocks":30,"24h_btc":0.01022405,"lastblock":27944,"timesincelast":8574}, "KMD":{"algo":"equihash","port":2142,"name":"Komodo","height":660393,"workers":483,"shares":3778,"hashrate":80508,"estimate":"0.33545","24h_blocks":43,"24h_btc":0.06846138,"lastblock":660343,"timesincelast":3446}, "KRONE":{"algo":"scrypt","port":3433,"name":"Krone","height":84950,"workers":1928,"shares":412,"hashrate":7055439258,"estimate":"2.57866","24h_blocks":26,"24h_btc":0.01156426,"lastblock":84933,"timesincelast":4380}, "LBC":{"algo":"lbry","port":3334,"name":"LBRY.io","height":303162,"workers":178,"shares":130925,"hashrate":36709600897,"estimate":"0.00097","24h_blocks":0,"24h_btc":0,"lastblock":302617,"timesincelast":87835}, "LCP":{"algo":"scrypt","port":3433,"name":"LitePlus","height":766566,"workers":2007,"shares":1951,"hashrate":39886955832,"estimate":"2.75685","24h_blocks":180,"24h_btc":0.0234007,"lastblock":766543,"timesincelast":863}, "LINDA":{"algo":"scrypt","port":3433,"name":"Linda","height":268630,"workers":2015,"shares":3036,"hashrate":66683643891,"estimate":"2.61895","24h_blocks":52,"24h_btc":0.32589622,"lastblock":268612,"timesincelast":1540}, "LINX":{"algo":"scrypt","port":3433,"name":"LinX","height":298108,"workers":2013,"shares":52,"hashrate":0,"estimate":"2.07389","24h_blocks":96,"24h_btc":0.21770277,"lastblock":298098,"timesincelast":1321}, "LIT":{"algo":"blakecoin","port":5743,"name":"Lithium","height":544696,"workers":14,"shares":0,"hashrate":0,"estimate":"0.01661","24h_blocks":1,"24h_btc":1.86e-5,"lastblock":544491,"timesincelast":40146}, "LTB":{"algo":"scrypt","port":3433,"name":"LiteBar","height":409401,"workers":2011,"shares":1197,"hashrate":23647236908,"estimate":"3.01789","24h_blocks":97,"24h_btc":0.01656355,"lastblock":409399,"timesincelast":791}, "LTC":{"algo":"scrypt","port":3433,"name":"Litecoin","height":1348039,"workers":2200,"shares":84,"hashrate":514955672,"estimate":"2.43433","24h_blocks":0,"24h_btc":0,"lastblock":1343640,"timesincelast":674397}, "LTCU":{"algo":"scrypt","port":3433,"name":"LiteUltra","height":14561,"workers":2014,"shares":52,"hashrate":0,"estimate":"1.28550","24h_blocks":3,"24h_btc":0.00229246,"lastblock":14542,"timesincelast":35878}, "LUX":{"algo":"phi","port":8333,"name":"Lux","height":141379,"workers":61,"shares":29319,"hashrate":4607569447,"estimate":"0.02303","24h_blocks":15,"24h_btc":0.29961867,"lastblock":141262,"timesincelast":8213}, "MAC":{"algo":"timetravel","port":3555,"name":"Machine","height":463284,"workers":18,"shares":779,"hashrate":2248401062,"estimate":"0.01106","24h_blocks":41,"24h_btc":0.00868486,"lastblock":463281,"timesincelast":1088}, "MAR":{"algo":"x11","port":3533,"name":"Marijuana","height":1020455,"workers":1889,"shares":244,"hashrate":0,"estimate":"0.01387","24h_blocks":3,"24h_btc":0.00014353,"lastblock":1020045,"timesincelast":14249}, "MARS":{"algo":"scrypt","port":3433,"name":"Mars","height":826230,"workers":2015,"shares":52,"hashrate":0,"estimate":"2.26458","24h_blocks":51,"24h_btc":0.00153257,"lastblock":826216,"timesincelast":10306}, "MATRX":{"algo":"scrypt","port":3433,"name":"Matrix","height":32963,"workers":2014,"shares":52,"hashrate":0,"estimate":"2.02012","24h_blocks":0,"24h_btc":0,"lastblock":18870,"timesincelast":5381482}, "MAX":{"algo":"keccak","port":5133,"name":"Max","height":2347574,"workers":145,"shares":2995,"hashrate":106249473631,"estimate":"0.19580","24h_blocks":1198,"24h_btc":0.02080319,"lastblock":2347573,"timesincelast":762}, "MAY":{"algo":"sha256","port":3333,"name":"May","height":102394,"workers":1033,"shares":91,"hashrate":0,"estimate":"134.27736","24h_blocks":18,"24h_btc":0.00422115,"lastblock":102381,"timesincelast":3873}, "MEC":{"algo":"scrypt","port":3433,"name":"Mega","height":934522,"workers":2016,"shares":52,"hashrate":0,"estimate":"2.37525","24h_blocks":9,"24h_btc":0.00090566,"lastblock":934487,"timesincelast":3418}, "MGT":{"algo":"skunk","port":8433,"name":"Magnatum","height":194409,"workers":66,"shares":14,"hashrate":0,"estimate":"0.00173","24h_blocks":0,"24h_btc":0,"lastblock":190374,"timesincelast":255614}, "MONA":{"algo":"lyra2v2","port":4533,"name":"Mona","height":1213888,"workers":319,"shares":9409,"hashrate":41143010786,"estimate":"0.00627","24h_blocks":31,"24h_btc":0.39287457,"lastblock":1213840,"timesincelast":4049}, "MONK":{"algo":"x11","port":3533,"name":"Monkey","height":27795,"workers":1888,"shares":1710,"hashrate":968749931493,"estimate":"0.02301","24h_blocks":64,"24h_btc":0.07265343,"lastblock":27792,"timesincelast":944}, "MUE":{"algo":"x11","port":3533,"name":"MonetaryUnit","height":350662,"workers":1903,"shares":6566,"hashrate":4643049262629,"estimate":"0.02567","24h_blocks":160,"24h_btc":0.07560689,"lastblock":350603,"timesincelast":2411}, "MZC":{"algo":"sha256","port":3333,"name":"Maza","height":971738,"workers":1037,"shares":492,"hashrate":2.1147097074457e+14,"estimate":"133.08228","24h_blocks":152,"24h_btc":0.05114231,"lastblock":971736,"timesincelast":1497}, "NEVA":{"algo":"blake2s","port":5766,"name":"Neva","height":506080,"workers":641,"shares":157,"hashrate":0,"estimate":"0.03307","24h_blocks":14,"24h_btc":0.00105214,"lastblock":506080,"timesincelast":4272}, "NKC":{"algo":"sha256","port":3333,"name":"Nuke","height":392666,"workers":1033,"shares":91,"hashrate":0,"estimate":"214.54770","24h_blocks":73,"24h_btc":0.00020443,"lastblock":392663,"timesincelast":1736}, "NLG":{"algo":"scrypt","port":3433,"name":"Gulden","height":665816,"workers":2015,"shares":5740,"hashrate":141803785225,"estimate":"2.58162","24h_blocks":116,"24h_btc":0.21142569,"lastblock":665807,"timesincelast":2087}, "NMS":{"algo":"skein","port":4933,"name":"Numus ","height":63274,"workers":200,"shares":1245,"hashrate":43507181198,"estimate":"0.00042","24h_blocks":67,"24h_btc":0.25784937,"lastblock":63228,"timesincelast":2405}, "NOTE":{"algo":"scrypt","port":3433,"name":"Dnotes","height":2043758,"workers":2015,"shares":116,"hashrate":1138454588,"estimate":"2.43365","24h_blocks":25,"24h_btc":0.00405363,"lastblock":2043543,"timesincelast":13021}, "NVC":{"algo":"scrypt","port":3433,"name":"Nova","height":392443,"workers":2016,"shares":77,"hashrate":357418269,"estimate":"2.48223","24h_blocks":0,"24h_btc":0,"lastblock":391390,"timesincelast":430803}, "ONION":{"algo":"x13","port":3633,"name":"DeepOnion","height":307758,"workers":102,"shares":1967,"hashrate":71869967647,"estimate":"0.00094","24h_blocks":9,"24h_btc":0.07578086,"lastblock":307552,"timesincelast":11215}, "ONX":{"algo":"x11","port":3533,"name":"Onix","height":121975,"workers":1901,"shares":254,"hashrate":4228127509,"estimate":"0.02887","24h_blocks":86,"24h_btc":0.01829242,"lastblock":121961,"timesincelast":1990}, "OOO":{"algo":"sha256","port":3333,"name":"Om","height":29485,"workers":1033,"shares":91,"hashrate":0,"estimate":"67.89184","24h_blocks":2,"24h_btc":0.00071225,"lastblock":29485,"timesincelast":50272}, "ORB":{"algo":"neoscrypt","port":4233,"name":"Orbit","height":2342826,"workers":3657,"shares":38,"hashrate":354200,"estimate":"0.29127","24h_blocks":18,"24h_btc":0.00098825,"lastblock":2342818,"timesincelast":2121}, "PAK":{"algo":"scrypt","port":3433,"name":"Pak","height":565732,"workers":2015,"shares":264,"hashrate":4581019501,"estimate":"2.94008","24h_blocks":64,"24h_btc":0.00760217,"lastblock":565731,"timesincelast":752}, "PINK":{"algo":"scrypt","port":3433,"name":"Pink","height":333862,"workers":2017,"shares":52,"hashrate":0,"estimate":"1.98891","24h_blocks":23,"24h_btc":0.00655604,"lastblock":333803,"timesincelast":3360}, "PIZZA":{"algo":"x11","port":3533,"name":"PiZZA","height":362805,"workers":1888,"shares":244,"hashrate":0,"estimate":"0.00022","24h_blocks":0,"24h_btc":0,"lastblock":335794,"timesincelast":2323992}, "PLC":{"algo":"sha256","port":3333,"name":"Pol","height":1356409,"workers":1033,"shares":91,"hashrate":0,"estimate":"67.48218","24h_blocks":89,"24h_btc":0.0029703,"lastblock":1356408,"timesincelast":56476}, "PLYS":{"algo":"polytimos","port":8463,"name":"Polytimos","height":25769,"workers":26,"shares":1205,"hashrate":603148099,"estimate":"0.01231","24h_blocks":41,"24h_btc":0.00615,"lastblock":25758,"timesincelast":2298}, "PPC":{"algo":"sha256","port":3333,"name":"Peer","height":343422,"workers":1035,"shares":506,"hashrate":1.8960802530982e+14,"estimate":"162.49875","24h_blocks":20,"24h_btc":0.37000676,"lastblock":343414,"timesincelast":3600}, "PUT":{"algo":"scrypt","port":3433,"name":"Putin","height":41311,"workers":2015,"shares":52,"hashrate":0,"estimate":"1.36351","24h_blocks":0,"24h_btc":0,"lastblock":40530,"timesincelast":535311}, "PXC":{"algo":"neoscrypt","port":4233,"name":"Phoenix","height":1611990,"workers":3662,"shares":38,"hashrate":354200,"estimate":"0.26978","24h_blocks":35,"24h_btc":0.00179564,"lastblock":1611741,"timesincelast":28847}, "QRK":{"algo":"quark","port":4033,"name":"Quark","height":5145925,"workers":60,"shares":539,"hashrate":46647585147,"estimate":"0.17647","24h_blocks":1874,"24h_btc":0.00590372,"lastblock":5145899,"timesincelast":850}, "QTL":{"algo":"scrypt","port":3433,"name":"Quatloo","height":637754,"workers":2016,"shares":52,"hashrate":0,"estimate":"0.81622","24h_blocks":94,"24h_btc":0.00271233,"lastblock":637726,"timesincelast":3764}, "RED":{"algo":"scrypt","port":3433,"name":"RedCoin","height":900307,"workers":2015,"shares":52,"hashrate":0,"estimate":"1.51672","24h_blocks":0,"24h_btc":0,"lastblock":899612,"timesincelast":102247}, "RGC":{"algo":"nist5","port":3833,"name":"RG","height":7492,"workers":982,"shares":219,"hashrate":0,"estimate":"0.00000","24h_blocks":0,"24h_btc":0,"lastblock":5253,"timesincelast":337206}, "RUP":{"algo":"scrypt","port":3433,"name":"Rupee","height":36646,"workers":2016,"shares":52,"hashrate":0,"estimate":"2.38805","24h_blocks":63,"24h_btc":0.14387672,"lastblock":36619,"timesincelast":13492}, "SAK":{"algo":"quark","port":4033,"name":"Shark","height":5409292,"workers":60,"shares":63,"hashrate":2978885622,"estimate":"0.10299","24h_blocks":1039,"24h_btc":0.00139624,"lastblock":5409292,"timesincelast":1007}, "SAND":{"algo":"x11","port":3533,"name":"Beach","height":83485,"workers":1888,"shares":1579,"hashrate":993994339856,"estimate":"0.03573","24h_blocks":156,"24h_btc":0.01776965,"lastblock":83471,"timesincelast":812}, "SFC":{"algo":"scrypt","port":3433,"name":"Solarflare","height":95820,"workers":2016,"shares":57,"hashrate":45751195,"estimate":"2.45966","24h_blocks":38,"24h_btc":0.00318951,"lastblock":95796,"timesincelast":7960}, "SIB":{"algo":"sib","port":5033,"name":"Sib","height":535934,"workers":80,"shares":5869,"hashrate":2515741245,"estimate":"0.01053","24h_blocks":31,"24h_btc":0.04584954,"lastblock":535915,"timesincelast":2089}, "SMC":{"algo":"x11","port":3533,"name":"Smart","height":966318,"workers":1887,"shares":757,"hashrate":350945888405,"estimate":"0.02565","24h_blocks":94,"24h_btc":0.00825645,"lastblock":966268,"timesincelast":7812}, "SONG":{"algo":"scrypt","port":3433,"name":"Song","height":529085,"workers":2016,"shares":825,"hashrate":15126954285,"estimate":"2.99267","24h_blocks":204,"24h_btc":0.02091334,"lastblock":529082,"timesincelast":848}, "SOON":{"algo":"sha256","port":3333,"name":"Soon","height":551839,"workers":1033,"shares":228,"hashrate":45035787762436,"estimate":"64.91124","24h_blocks":159,"24h_btc":0.00494136,"lastblock":551838,"timesincelast":3248}, "SPACE":{"algo":"scrypt","port":3433,"name":"Space","height":1117717,"workers":2016,"shares":52,"hashrate":0,"estimate":"1.14585","24h_blocks":0,"24h_btc":0,"lastblock":1113104,"timesincelast":531498}, "START":{"algo":"x11","port":3533,"name":"Start","height":1480173,"workers":1895,"shares":244,"hashrate":0,"estimate":"0.03248","24h_blocks":58,"24h_btc":0.01507915,"lastblock":1480129,"timesincelast":3147}, "SXC":{"algo":"scrypt","port":3433,"name":"Sex","height":2572069,"workers":2016,"shares":535,"hashrate":8885151117,"estimate":"3.37433","24h_blocks":79,"24h_btc":0.00391865,"lastblock":2572069,"timesincelast":765}, "TAJ":{"algo":"blake2s","port":5766,"name":"Taj","height":146842,"workers":640,"shares":157,"hashrate":0,"estimate":"0.03303","24h_blocks":12,"24h_btc":0.00361778,"lastblock":146839,"timesincelast":4260}, "THC":{"algo":"scrypt","port":3433,"name":"Hemp","height":2009611,"workers":2017,"shares":2035,"hashrate":49216834443,"estimate":"2.06361","24h_blocks":226,"24h_btc":0.0665704,"lastblock":2009607,"timesincelast":907}, "TIT":{"algo":"sha256","port":3333,"name":"Tit","height":1428843,"workers":1033,"shares":114,"hashrate":6755459260468,"estimate":"144.55420","24h_blocks":97,"24h_btc":0.00427691,"lastblock":1428839,"timesincelast":1525}, "UIS":{"algo":"yescrypt","port":6233,"name":"Unitus","height":1259236,"workers":17916,"shares":267,"hashrate":0,"estimate":"0.00384","24h_blocks":156,"24h_btc":0.02532855,"lastblock":1259195,"timesincelast":4781}, "UIS-lyra":{"algo":"lyra2v2","port":4533,"name":"Unitus","height":1259236,"workers":312,"shares":77,"hashrate":0,"estimate":"0.00022","24h_blocks":105,"24h_btc":0.01710346,"lastblock":1259203,"timesincelast":3781,"symbol":"UIS"}, "UIS-skein":{"algo":"skein","port":4933,"name":"Unitus","height":1259236,"workers":200,"shares":19,"hashrate":0,"estimate":"0.00004","24h_blocks":36,"24h_btc":0.0059149,"lastblock":1259130,"timesincelast":8786,"symbol":"UIS"}, "UIS-x11":{"algo":"x11","port":3533,"name":"Unitus","height":1259236,"workers":1887,"shares":244,"hashrate":0,"estimate":"0.00022","24h_blocks":22,"24h_btc":0.00361515,"lastblock":1259108,"timesincelast":10216,"symbol":"UIS"}, "UNB":{"algo":"sha256","port":3333,"name":"Unbreakable","height":82670,"workers":1034,"shares":91,"hashrate":0,"estimate":"65.06958","24h_blocks":0,"24h_btc":0,"lastblock":82655,"timesincelast":1224706}, "UNIC":{"algo":"sha256","port":3333,"name":"Uni","height":1268830,"workers":1033,"shares":91,"hashrate":0,"estimate":"105.62007","24h_blocks":19,"24h_btc":0.0004646,"lastblock":1268829,"timesincelast":56935}, "VIA":{"algo":"scrypt","port":3433,"name":"Via","height":4547720,"workers":2015,"shares":52,"hashrate":0,"estimate":"0.01151","24h_blocks":24,"24h_btc":0.00295995,"lastblock":4547524,"timesincelast":4607}, "VLT":{"algo":"veltor","port":5034,"name":"Veltor","height":23429,"workers":34,"shares":1075,"hashrate":2663515608,"estimate":"0.01293","24h_blocks":38,"24h_btc":0.04209492,"lastblock":23429,"timesincelast":1646}, "VLTC":{"algo":"x11","port":3533,"name":"Vault","height":170756,"workers":1886,"shares":244,"hashrate":0,"estimate":"0.01965","24h_blocks":0,"24h_btc":0,"lastblock":170475,"timesincelast":186946}, "VTC":{"algo":"lyra2v2","port":4533,"name":"Vert","height":856981,"workers":326,"shares":12124,"hashrate":52695495739,"estimate":"0.00700","24h_blocks":30,"24h_btc":0.29589521,"lastblock":856968,"timesincelast":1478}, "WDC":{"algo":"scrypt","port":3433,"name":"World","height":3567963,"workers":2015,"shares":52,"hashrate":0,"estimate":"2.23285","24h_blocks":1,"24h_btc":6.106e-5,"lastblock":3567359,"timesincelast":85338}, "XCT":{"algo":"sha256","port":3333,"name":"C-Bit","height":496940,"workers":1037,"shares":94,"hashrate":1421446240046,"estimate":"124.97830","24h_blocks":28,"24h_btc":0.00203746,"lastblock":496936,"timesincelast":4972}, "XGOX":{"algo":"scrypt","port":3433,"name":"Go","height":163487,"workers":2015,"shares":52,"hashrate":0,"estimate":"1.84739","24h_blocks":0,"24h_btc":0,"lastblock":162062,"timesincelast":153618}, "XJO":{"algo":"sha256","port":3333,"name":"Joule","height":3076196,"workers":1033,"shares":155,"hashrate":23461009666936,"estimate":"157.66362","24h_blocks":323,"24h_btc":0.00425013,"lastblock":3076179,"timesincelast":1508}, "XMCC":{"algo":"x11","port":3533,"name":"Monaco","height":125330,"workers":1890,"shares":244,"hashrate":0,"estimate":"0.01365","24h_blocks":32,"24h_btc":0.06357176,"lastblock":125315,"timesincelast":1343}, "XMY":{"algo":"yescrypt","port":6233,"name":"Myriad","height":2302939,"workers":17976,"shares":49255,"hashrate":6852666,"estimate":"0.02017","24h_blocks":127,"24h_btc":0.0749016,"lastblock":2302853,"timesincelast":4767}, "XMY-Groestl":{"algo":"myr-gr","port":5433,"name":"Myriad","height":2302912,"workers":20,"shares":297,"hashrate":103116856596,"estimate":"0.00032","24h_blocks":145,"24h_btc":0.08606017,"lastblock":2302893,"timesincelast":1374,"symbol":"XMY"}, "XMY-Scrypt":{"algo":"scrypt","port":3433,"name":"Myriad","height":2302912,"workers":2015,"shares":52,"hashrate":0,"estimate":"0.00760","24h_blocks":2,"24h_btc":0.00116621,"lastblock":2302178,"timesincelast":57085,"symbol":"XMY"}, "XMY-sha":{"algo":"sha256","port":3333,"name":"Myriad","height":2302912,"workers":1033,"shares":91,"hashrate":0,"estimate":"0.08802","24h_blocks":0,"24h_btc":0,"lastblock":2297332,"timesincelast":486035,"symbol":"XMY"}, "XMY-skein":{"algo":"skein","port":4933,"name":"Myriad","height":2302912,"workers":199,"shares":618,"hashrate":18156769413,"estimate":"0.00062","24h_blocks":8,"24h_btc":0.00510584,"lastblock":2302897,"timesincelast":1096,"symbol":"XMY"}, "XPTX":{"algo":"quark","port":4033,"name":"PlatinumBar","height":609678,"workers":60,"shares":97,"hashrate":6786568141,"estimate":"0.04222","24h_blocks":97,"24h_btc":0.00024056,"lastblock":609671,"timesincelast":1518}, "XRE":{"algo":"x11evo","port":3553,"name":"Revolver","height":843336,"workers":10,"shares":155,"hashrate":153755706,"estimate":"0.01873","24h_blocks":619,"24h_btc":0.00364798,"lastblock":843333,"timesincelast":764}, "XVG":{"algo":"scrypt","port":3433,"name":"Verge","height":1790340,"workers":2183,"shares":3391,"hashrate":72258291788,"estimate":"3.05554","24h_blocks":24,"24h_btc":0.39852776,"lastblock":1790307,"timesincelast":1530}, "XVG-blake2s":{"algo":"blake2s","port":5766,"name":"Verge","height":1790340,"workers":638,"shares":14418,"hashrate":8237951599639,"estimate":"0.04847","24h_blocks":18,"24h_btc":0.31333278,"lastblock":1790325,"timesincelast":1130,"symbol":"XVG"}, "XVG-groestl":{"algo":"myr-gr","port":5433,"name":"Verge","height":1790340,"workers":20,"shares":122,"hashrate":40871331886,"estimate":"0.00053","24h_blocks":1,"24h_btc":0.01689829,"lastblock":1788762,"timesincelast":53412,"symbol":"XVG"}, "XVG-lyra":{"algo":"lyra2v2","port":4533,"name":"Verge","height":1790340,"workers":313,"shares":77,"hashrate":0,"estimate":"0.00375","24h_blocks":17,"24h_btc":0.30128156,"lastblock":1790124,"timesincelast":7786,"symbol":"XVG"}, "XVG-x17":{"algo":"x17","port":3737,"name":"Verge","height":1790340,"workers":1175,"shares":46012,"hashrate":79124375172,"estimate":"0.07215","24h_blocks":177,"24h_btc":3.11939001,"lastblock":1790334,"timesincelast":744,"symbol":"XVG"}, "ZCL":{"algo":"equihash","port":2142,"name":"Zclassic","height":245151,"workers":495,"shares":6029,"hashrate":135582,"estimate":"0.66947","24h_blocks":0,"24h_btc":0,"lastblock":243803,"timesincelast":206856}, "ZSE":{"algo":"x11","port":3533,"name":"ZSEcoin","height":190498,"workers":1884,"shares":289,"hashrate":21276299390,"estimate":"0.02920","24h_blocks":11,"24h_btc":0.0005752,"lastblock":190490,"timesincelast":3019}, "ZYD":{"algo":"sha256","port":3333,"name":"Zayed","height":353394,"workers":1034,"shares":91,"hashrate":0,"estimate":"4.91385","24h_blocks":0,"24h_btc":0,"lastblock":350847,"timesincelast":338783}}')  # NOQA

    def _get_algo_api_resp(self):
        return loads('{"bitcore":{"name":"bitcore","port":3556,"coins":1,"fees":2,"hashrate":997670389,"workers":20,"estimate_current":"0.00002644","estimate_last24h":"0.00002243","actual_last24h":"0.00000","hashrate_last24h":192852264.0521},"blake2s":{"name":"blake2s","port":5766,"coins":3,"fees":2,"hashrate":932767024385,"workers":1625,"estimate_current":"0.00016958","estimate_last24h":"0.00008546","actual_last24h":"0.06481","hashrate_last24h":5262060920694.3},"blakecoin":{"name":"blakecoin","port":5743,"coins":2,"fees":2,"hashrate":97196827895,"workers":20,"estimate_current":"0.00006274","estimate_last24h":"0.00005717","actual_last24h":"0.04591","hashrate_last24h":57603872309.062},"c11":{"name":"c11","port":3573,"coins":2,"fees":2,"hashrate":3174451331,"workers":110,"estimate_current":"0.00001660","estimate_last24h":"0.00002176","actual_last24h":"0.02736","hashrate_last24h":2230559692.4063},"equihash":{"name":"equihash","port":2142,"coins":3,"fees":1.75,"hashrate":558361.736,"workers":548,"estimate_current":"0.00055205","estimate_last24h":"0.00062147","actual_last24h":"0.38628","hashrate_last24h":483760.5965416},"groestl":{"name":"groestl","port":5333,"coins":1,"fees":2,"hashrate":359602755,"workers":24,"estimate_current":"0.00000351","estimate_last24h":"0.00000423","actual_last24h":"0.00000","hashrate_last24h":216983686.3958},"hsr":{"name":"hsr","port":7433,"coins":1,"fees":2,"hashrate":49023558,"workers":9,"estimate_current":"0.00002167","estimate_last24h":"0.00002323","actual_last24h":"0.00732","hashrate_last24h":279678191.5208},"keccak":{"name":"keccak","port":5133,"coins":1,"fees":2,"hashrate":113028650011,"workers":159,"estimate_current":"0.00018759","estimate_last24h":"0.00020926","actual_last24h":"0.19915","hashrate_last24h":104248419734.45},"lbry":{"name":"lbry","port":3334,"coins":1,"fees":2,"hashrate":35966170698,"workers":169,"estimate_current":"0.00000071","estimate_last24h":"0.00000084","actual_last24h":"0.00000","hashrate_last24h":110490653616.93},"lyra2v2":{"name":"lyra2v2","port":4533,"coins":4,"fees":1.75,"hashrate":99495035632,"workers":1076,"estimate_current":"0.00000717","estimate_last24h":"0.00000837","actual_last24h":"0.00948","hashrate_last24h":108137993299.03},"myr-gr":{"name":"myr-gr","port":5433,"coins":4,"fees":2,"hashrate":633069474963,"workers":86,"estimate_current":"0.00000029","estimate_last24h":"0.00000029","actual_last24h":"0.00023","hashrate_last24h":616672320619.45},"neoscrypt":{"name":"neoscrypt","port":4233,"coins":8,"fees":2,"hashrate":7916615720,"workers":2482,"estimate_current":"0.00037290","estimate_last24h":"0.00044576","actual_last24h":"0.41489","hashrate_last24h":6139653405.5208},"nist5":{"name":"nist5","port":3833,"coins":2,"fees":2,"hashrate":111224631805,"workers":760,"estimate_current":"0.00001082","estimate_last24h":"0.00000918","actual_last24h":"0.00785","hashrate_last24h":102535092989.18},"phi":{"name":"phi","port":8333,"coins":1,"fees":2,"hashrate":8341100450,"workers":82,"estimate_current":"0.00002405","estimate_last24h":"0.00002882","actual_last24h":"0.02740","hashrate_last24h":10934799513.26},"polytimos":{"name":"polytimos","port":8463,"coins":1,"fees":2,"hashrate":615389328,"workers":29,"estimate_current":"0.00000958","estimate_last24h":"0.00000872","actual_last24h":"0.01075","hashrate_last24h":571899023.6875},"quark":{"name":"quark","port":4033,"coins":3,"fees":2,"hashrate":57165852532,"workers":64,"estimate_current":"0.00018352","estimate_last24h":"0.00012359","actual_last24h":"0.11427","hashrate_last24h":65399116088.708},"qubit":{"name":"qubit","port":4733,"coins":2,"fees":2,"hashrate":214154196046,"workers":261,"estimate_current":"0.00055628","estimate_last24h":"0.00059372","actual_last24h":"0.71904","hashrate_last24h":250445608821.64},"scrypt":{"name":"scrypt","port":3433,"coins":58,"fees":1,"hashrate":1075393721517,"workers":2476,"estimate_current":"0.00325577","estimate_last24h":"0.00348740","actual_last24h":"2.37037","hashrate_last24h":886915335364.23},"sha256":{"name":"sha256","port":3333,"coins":25,"fees":1.5,"hashrate":7.8707979856423e+15,"workers":1260,"estimate_current":"0.15150829","estimate_last24h":"0.16672813","actual_last24h":"165.04698","hashrate_last24h":5.4857223282234e+15},"sib":{"name":"sib","port":5033,"coins":1,"fees":2,"hashrate":1515625468,"workers":158,"estimate_current":"0.00003415","estimate_last24h":"0.00002625","actual_last24h":"0.04122","hashrate_last24h":1112377135.5208},"skein":{"name":"skein","port":4933,"coins":5,"fees":2,"hashrate":683220164767,"workers":460,"estimate_current":"0.00000054","estimate_last24h":"0.00000090","actual_last24h":"0.00092","hashrate_last24h":510848604004.4},"skunk":{"name":"skunk","port":8433,"coins":2,"fees":2,"hashrate":5939151329,"workers":38,"estimate_current":"0.00000903","estimate_last24h":"0.00001099","actual_last24h":"0.01071","hashrate_last24h":8629577331},"timetravel":{"name":"timetravel","port":3555,"coins":1,"fees":2,"hashrate":940325698,"workers":75,"estimate_current":"0.00002086","estimate_last24h":"0.00000864","actual_last24h":"0.00790","hashrate_last24h":1049921990.4271},"tribus":{"name":"tribus","port":8533,"coins":1,"fees":2,"hashrate":7440541787,"workers":27,"estimate_current":"0.00000120","estimate_last24h":"0.00000680","actual_last24h":"0.00498","hashrate_last24h":24270143522},"veltor":{"name":"veltor","port":5034,"coins":1,"fees":2,"hashrate":6506851173,"workers":39,"estimate_current":"0.00001303","estimate_last24h":"0.00001131","actual_last24h":"0.01538","hashrate_last24h":2660911139.625},"x11":{"name":"x11","port":3533,"coins":28,"fees":0.85,"hashrate":29422432714015,"workers":2596,"estimate_current":"0.00002722","estimate_last24h":"0.00003702","actual_last24h":"0.03504","hashrate_last24h":31750110435972},"x11evo":{"name":"x11evo","port":3553,"coins":1,"fees":2,"hashrate":187679305,"workers":12,"estimate_current":"0.00001323","estimate_last24h":"0.00002068","actual_last24h":"0.01990","hashrate_last24h":183762447.3646},"x13":{"name":"x13","port":3633,"coins":2,"fees":2,"hashrate":77048761102,"workers":115,"estimate_current":"0.00000093","estimate_last24h":"0.00000098","actual_last24h":"0.00159","hashrate_last24h":48070479774.604},"x14":{"name":"x14","port":3933,"coins":1,"fees":2,"hashrate":7651750640,"workers":26,"estimate_current":"0.00000061","estimate_last24h":"0.00000086","actual_last24h":"0.00090","hashrate_last24h":13593734127.99},"x17":{"name":"x17","port":3737,"coins":1,"fees":2,"hashrate":69029216492,"workers":2772,"estimate_current":"0.00004454","estimate_last24h":"0.00005299","actual_last24h":"0.04322","hashrate_last24h":72324461697.24},"xevan":{"name":"xevan","port":3739,"coins":1,"fees":2,"hashrate":694098879,"workers":174,"estimate_current":"0.00006615","estimate_last24h":"0.00008493","actual_last24h":"0.07343","hashrate_last24h":333335644.8125},"yescrypt":{"name":"yescrypt","port":6233,"coins":3,"fees":2,"hashrate":6703605,"workers":18449,"estimate_current":"0.00001921","estimate_last24h":"0.00002213","actual_last24h":"0.01866","hashrate_last24h":6551784.9688}}')  # NOQA

    def _get_miner_mock(self, algo, *args, **kwargs):
        miner = MagicMock()
        rate = MagicMock()
        miner._algo = algo
        if algo == "skein":
            rate.get_mbtc_per_day = lambda x: 10.0
        elif algo == "lyra2v2":
            rate.get_mbtc_per_day = lambda x: 5.0
        else:
            rate.get_mbtc_per_day = lambda x: 0.0

        miner.benchmark = lambda: rate

        return miner

    def _fetch_json_api_mock(self, url):
        self.assertTrue("status" in url or "currencies" in url)
        if "status" in url:
            return self._get_algo_api_resp()
        elif "currencies" in url:
            return self._get_currency_api_resp()

    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.zpool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_algo(self, get_miner_for_algo, fetch_json_api):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa")
        miner = z.get_most_profitable_miner()
        fetch_json_api.assert_called_with("http://www.zpool.ca/api/status")
        self.assertEqual(miner._algo, "skein")

    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.zpool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_currency(self, get_miner_for_algo, fetch_json_api):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa", algo_data_source="currency")
        miner = z.get_most_profitable_miner()
        fetch_json_api.assert_called_with("http://www.zpool.ca/api/currencies")
        self.assertEqual(miner._algo, "skein")

    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.zpool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_algo_blacklist(self, get_miner_for_algo, fetch_json_api):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa", algo_blacklist={"skein"})
        miner = z.get_most_profitable_miner()
        self.assertEqual(miner._algo, "lyra2v2")

    @patch("speed_miner.mining_groups.zpool_mining_group.LOG.debug")
    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.zpool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_calc_all_algo_data_sources(
            self, get_miner_for_algo, fetch_json_api, debug):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa", calc_all_algo_data_sources=True)
        miner = z.get_most_profitable_miner()
        fetch_json_api.assert_has_calls(
            [call("http://www.zpool.ca/api/currencies"), call("http://www.zpool.ca/api/status")])
        self.assertEqual(miner._algo, "skein")

        good_logs = ["Finding most profitable", "Loading benchmarks"]
        logs = [c[0][0] for c in debug.call_args_list if any(l in c[0][0] for l in good_logs)]
        self.assertIn("currency", logs[0])
        self.assertIn("Loading benchmarks from cache", logs[1])
        self.assertIn("algo", logs[2])
        self.assertIn("Loading benchmarks from cache", logs[3])
