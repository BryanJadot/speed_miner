from json import loads
from unittest.mock import call, MagicMock, patch

from speed_miner.mining_groups.zpool_mining_group import ZPoolMiningGroup, ZPoolMiningGroupLoader
from speed_miner.miner import MinerConfigLoader
from speed_miner.misc.config_loader import MiningConfigManager

from tests.util.test_case import MinerTestCase


class TestZPoolMinerConfigLoader(MinerTestCase):

    def setUp(self):
        self.c = ZPoolMiningGroupLoader()

    def test_good_dict_parse(self):
        d = {
            "payout_currency": "btc",
            "algo_blacklist": "skein, equihash",
            "algo_data_source": "currency",
            "calc_all_algo_data_sources": "true",
        }
        config = self.c.process_config_from_dict(d)
        self.assertEqual(config["payout_currency"], "BTC")
        self.assertEqual(config["algo_blacklist"], {"skein", "equihash"})
        self.assertEqual(config["algo_data_source"], "currency")
        self.assertEqual(config["calc_all_algo_data_sources"], True)

        d = {
            "payout_currency": "btc",
        }
        config = self.c.process_config_from_dict(d)
        self.assertEqual(config["payout_currency"], "BTC")
        self.assertEqual(config["algo_blacklist"], set())
        self.assertEqual(config["algo_data_source"], "algo")
        self.assertEqual(config["calc_all_algo_data_sources"], False)

    def _check_desc(self, _exit, _print):
        _exit.assert_called_with(1)
        desc = _print.call_args[0][0]
        self.assertIn("Looks like you're trying", desc)
        self.assertIn("A list of algos to not mine", desc)
        self.assertIn("Put the desired", desc)
        self.assertIn("profitability from all", desc)
        self.assertIn("default: \"algo\"", desc)
        self.assertIn("default: \"\"", desc)
        self.assertIn("default: \"false\"", desc)

    @patch("speed_miner.misc.config_loader.print")
    @patch("speed_miner.misc.config_loader.exit")
    def test_bad_param(self, _exit, _print):
        d = {
            "payout_currency": "btc",
            "algo_blacklist": "skein, equihash",
            "algo_data_source": "currencfdsay",
        }
        self.c.process_config_from_dict(d)
        self._check_desc(_exit, _print)


class TestZPoolMiningGroup(MinerTestCase):

    def test_get_group_config_loader(self):
        self.assertTrue(isinstance(
            ZPoolMiningGroup.get_group_config_loader(), ZPoolMiningGroupLoader))

    def test_init_from_config(self):
        d = {
            "wallet": "fdsa",
            "payout_currency": "btc",
            "group": "zpool",
        }
        config_man = MiningConfigManager()

        main_config_loader = MinerConfigLoader()
        config_man.load_from_dict(main_config_loader, d)

        group_config_loader = ZPoolMiningGroupLoader()
        config_man.load_from_dict(group_config_loader, d)

        config = config_man.get_config()

        self.assertTrue(isinstance(ZPoolMiningGroup.init_from_config(config), ZPoolMiningGroup))

    def _get_currency_api_resp(self):
        return loads('{"4CHN":{"algo":"scrypt","port":3433,"name":"Chan","height":22284,"workers":1984,"shares":55,"hashrate":0,"estimate":"1.06043","24h_blocks":0,"24h_btc":0,"lastblock":22200,"timesincelast":399662}, "ABY":{"algo":"scrypt","port":3433,"name":"ArtByte","height":956726,"workers":1984,"shares":55,"hashrate":0,"estimate":"6.66578","24h_blocks":14,"24h_btc":0.01015062,"lastblock":956646,"timesincelast":13617}, "ACC":{"algo":"scrypt","port":3433,"name":"Adcoin","height":16656,"workers":1984,"shares":55,"hashrate":0,"estimate":"1.32184","24h_blocks":0,"24h_btc":0,"lastblock":13631,"timesincelast":667260}, "ACOIN":{"algo":"sha256","port":3333,"name":"A","height":3877785,"workers":783,"shares":33,"hashrate":0,"estimate":"55.85066","24h_blocks":2,"24h_btc":7.3e-7,"lastblock":3877539,"timesincelast":7555}, "ADZ":{"algo":"x11","port":3533,"name":"Adz","height":402418,"workers":1901,"shares":166,"hashrate":0,"estimate":"0.01905","24h_blocks":10,"24h_btc":0.00254837,"lastblock":402393,"timesincelast":67229}, "ALEX":{"algo":"sha256","port":3333,"name":"Alexandrite","height":232347,"workers":783,"shares":44,"hashrate":9426392861281,"estimate":"144.49611","24h_blocks":144,"24h_btc":0.00195224,"lastblock":232331,"timesincelast":2012}, "ALL":{"algo":"scrypt","port":3433,"name":"Allion","height":439827,"workers":1984,"shares":55,"hashrate":0,"estimate":"1.27360","24h_blocks":0,"24h_btc":0,"lastblock":439588,"timesincelast":187810}, "ALTCOM":{"algo":"skunk","port":8433,"name":"AltCom","height":168991,"workers":57,"shares":764,"hashrate":11724312389,"estimate":"0.00839","24h_blocks":148,"24h_btc":0.0811483,"lastblock":168977,"timesincelast":1887}, "APC":{"algo":"sha256","port":3333,"name":"Alpa","height":115783,"workers":783,"shares":33,"hashrate":0,"estimate":"4.77579","24h_blocks":0,"24h_btc":0,"lastblock":115574,"timesincelast":2317760}, "ARC":{"algo":"x11","port":3533,"name":"Arctic","height":273425,"workers":1901,"shares":166,"hashrate":0,"estimate":"0.01937","24h_blocks":0,"24h_btc":0,"lastblock":252907,"timesincelast":3231906}, "ARG":{"algo":"scrypt","port":3433,"name":"Argentum","height":2857237,"workers":1984,"shares":55,"hashrate":0,"estimate":"0.00204","24h_blocks":23,"24h_btc":9.58e-5,"lastblock":2857144,"timesincelast":4897}, "ARG-sha":{"algo":"sha256","port":3333,"name":"Argentum","height":2857238,"workers":783,"shares":33,"hashrate":0,"estimate":"3.75947","24h_blocks":644,"24h_btc":0.0028264,"lastblock":2857195,"timesincelast":2359,"symbol":"ARG"}, "AUR":{"algo":"scrypt","port":3433,"name":"Aurora","height":1186533,"workers":1984,"shares":55,"hashrate":0,"estimate":"2.30424","24h_blocks":14,"24h_btc":0.00412328,"lastblock":1186429,"timesincelast":2684}, "AUR-groestl":{"algo":"myr-gr","port":5433,"name":"Aurora","height":1186533,"workers":21,"shares":327,"hashrate":315846961015,"estimate":"0.00034","24h_blocks":76,"24h_btc":0.02263015,"lastblock":1186514,"timesincelast":1571,"symbol":"AUR"}, "BCH":{"algo":"sha256","port":3333,"name":"BitCash","height":512385,"workers":787,"shares":33,"hashrate":0,"estimate":"163.53625","24h_blocks":0,"24h_btc":0,"lastblock":0,"timesincelast":0}, "BDL":{"algo":"scrypt","port":3433,"name":"Bitdeal","height":71777,"workers":1984,"shares":55,"hashrate":0,"estimate":"0.57005","24h_blocks":0,"24h_btc":0,"lastblock":70799,"timesincelast":2938220}, "BELA":{"algo":"scrypt","port":3433,"name":"Bela","height":846962,"workers":1985,"shares":55,"hashrate":0,"estimate":"0.16257","24h_blocks":0,"24h_btc":0,"lastblock":845997,"timesincelast":133285}, "BENJI":{"algo":"scrypt","port":3433,"name":"BenjiRolls","height":246319,"workers":1984,"shares":55,"hashrate":0,"estimate":"1.44158","24h_blocks":0,"24h_btc":0,"lastblock":239452,"timesincelast":2484920}, "BERN":{"algo":"x14","port":3933,"name":"Bern","height":1416417,"workers":23,"shares":162,"hashrate":9237422329,"estimate":"0.00060","24h_blocks":421,"24h_btc":0.01171374,"lastblock":1416388,"timesincelast":2076}, "BLC":{"algo":"blakecoin","port":5743,"name":"Blake","height":670234,"workers":15,"shares":55,"hashrate":40755231003,"estimate":"0.05236","24h_blocks":30,"24h_btc":0.00335355,"lastblock":670214,"timesincelast":4875}, "BOLI":{"algo":"x11","port":3533,"name":"Bolivar","height":349420,"workers":1901,"shares":166,"hashrate":0,"estimate":"0.00459","24h_blocks":67,"24h_btc":0.01008585,"lastblock":349411,"timesincelast":58203}, "BSD":{"algo":"xevan","port":3739,"name":"BitSend","height":420944,"workers":145,"shares":1338,"hashrate":263969799,"estimate":"0.06021","24h_blocks":57,"24h_btc":0.0263008,"lastblock":420936,"timesincelast":2173}, "BSTY":{"algo":"yescrypt","port":6233,"name":"GlobalBoost","height":166717,"workers":18120,"shares":866,"hashrate":50884,"estimate":"0.02368","24h_blocks":96,"24h_btc":0.01953157,"lastblock":166717,"timesincelast":3462}, "BTB":{"algo":"scrypt","port":3433,"name":"BitBar","height":258077,"workers":1984,"shares":60,"hashrate":140540378,"estimate":"2.99892","24h_blocks":83,"24h_btc":0.02362728,"lastblock":258066,"timesincelast":1893}, "BTX":{"algo":"bitcore","port":3556,"name":"BitCore","height":115658,"workers":21,"shares":39876,"hashrate":438015057,"estimate":"0.02358","24h_blocks":0,"24h_btc":0,"lastblock":112873,"timesincelast":432512}, "BUCKS":{"algo":"scrypt","port":3433,"name":"SwagBucks","height":339557,"workers":1984,"shares":55,"hashrate":0,"estimate":"1.57854","24h_blocks":13,"24h_btc":0.00283897,"lastblock":339421,"timesincelast":14786}, "BWK":{"algo":"nist5","port":3833,"name":"Bulwark","height":36596,"workers":1507,"shares":66189,"hashrate":172423830171,"estimate":"0.01280","24h_blocks":29,"24h_btc":0.84566094,"lastblock":36569,"timesincelast":3259}, "CANN":{"algo":"x11","port":3533,"name":"Cannabis","height":2647661,"workers":1972,"shares":8922,"hashrate":17344910197310,"estimate":"0.04216","24h_blocks":173,"24h_btc":0.20178064,"lastblock":2647633,"timesincelast":1992}, "CAT":{"algo":"scrypt","port":3433,"name":"Cat","height":125320,"workers":1985,"shares":55,"hashrate":0,"estimate":"1.54694","24h_blocks":0,"24h_btc":0,"lastblock":125298,"timesincelast":120399}, "CESC":{"algo":"scrypt","port":3433,"name":"CryptoEscudo","height":982288,"workers":1985,"shares":55,"hashrate":0,"estimate":"0.16257","24h_blocks":0,"24h_btc":0,"lastblock":968413,"timesincelast":1646551}, "CHC":{"algo":"c11","port":3573,"name":"Chain","height":1357050,"workers":120,"shares":1248,"hashrate":3566727760,"estimate":"0.02433","24h_blocks":197,"24h_btc":0.06482804,"lastblock":1357035,"timesincelast":1800}, "CJ":{"algo":"x13","port":3633,"name":"CryptoJacks","height":1530578,"workers":77,"shares":552,"hashrate":0,"estimate":"0.00071","24h_blocks":28,"24h_btc":0.00031316,"lastblock":1530285,"timesincelast":8981}, "CMPCO":{"algo":"scrypt","port":3433,"name":"Campus","height":225347,"workers":1997,"shares":1133,"hashrate":54921870393,"estimate":"2.02174","24h_blocks":162,"24h_btc":0.16114291,"lastblock":225325,"timesincelast":1830}, "CNO":{"algo":"x11","port":3533,"name":"Coino","height":63803,"workers":1900,"shares":166,"hashrate":0,"estimate":"0.00583","24h_blocks":0,"24h_btc":0,"lastblock":62669,"timesincelast":274488}, "COPPER":{"algo":"scrypt","port":3433,"name":"Copper","height":152038,"workers":1986,"shares":687,"hashrate":32194247680,"estimate":"2.85759","24h_blocks":185,"24h_btc":0.04174587,"lastblock":152024,"timesincelast":1924}, "CPN":{"algo":"scrypt","port":3433,"name":"Compu","height":1683441,"workers":1985,"shares":55,"hashrate":0,"estimate":"1.65417","24h_blocks":0,"24h_btc":0,"lastblock":1683416,"timesincelast":105368}, "CRC":{"algo":"neoscrypt","port":4233,"name":"Crowd","height":29254,"workers":1731,"shares":9240,"hashrate":2304035382,"estimate":"0.32580","24h_blocks":60,"24h_btc":1.13068437,"lastblock":29243,"timesincelast":2270}, "CRM":{"algo":"x11","port":3533,"name":"Cream","height":115206,"workers":1900,"shares":166,"hashrate":0,"estimate":"0.01912","24h_blocks":13,"24h_btc":0.00082874,"lastblock":115191,"timesincelast":2707}, "CRW":{"algo":"sha256","port":3333,"name":"Crown","height":1704711,"workers":783,"shares":33,"hashrate":0,"estimate":"0.92771","24h_blocks":3,"24h_btc":0.00180038,"lastblock":1704471,"timesincelast":15439}, "DASH":{"algo":"x11","port":3533,"name":"Dash","height":802123,"workers":2350,"shares":6908,"hashrate":13223897959119,"estimate":"0.04119","24h_blocks":2,"24h_btc":0.25407729,"lastblock":801873,"timesincelast":40223}, "DFS":{"algo":"scrypt","port":3433,"name":"Dfs","height":364666,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.20457","24h_blocks":350,"24h_btc":0.12131212,"lastblock":364624,"timesincelast":1790}, "DGB":{"algo":"qubit","port":4733,"name":"Digibyte","height":5884757,"workers":189,"shares":665,"hashrate":95246810113,"estimate":"0.38774","24h_blocks":26,"24h_btc":0.14114869,"lastblock":5884593,"timesincelast":2992}, "DGB-Groestl":{"algo":"myr-gr","port":5433,"name":"Digibyte","height":5884757,"workers":21,"shares":81,"hashrate":66246819669,"estimate":"0.00049","24h_blocks":3,"24h_btc":0.016479,"lastblock":5883780,"timesincelast":14900,"symbol":"DGB"}, "DGB-Scrypt":{"algo":"scrypt","port":3433,"name":"Digibyte","height":5884757,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.38758","24h_blocks":15,"24h_btc":0.08312731,"lastblock":5884279,"timesincelast":7479,"symbol":"DGB"}, "DGB-sha":{"algo":"sha256","port":3333,"name":"Digibyte","height":5884755,"workers":783,"shares":2124,"hashrate":3.6778628193082e+15,"estimate":"154.18588","24h_blocks":92,"24h_btc":0.50096996,"lastblock":5884563,"timesincelast":3341,"symbol":"DGB"}, "DGB-skein":{"algo":"skein","port":4933,"name":"Digibyte","height":5884757,"workers":531,"shares":18,"hashrate":516476162,"estimate":"0.00039","24h_blocks":30,"24h_btc":0.17006038,"lastblock":5884480,"timesincelast":4774,"symbol":"DGB"}, "DGC":{"algo":"x11","port":3533,"name":"Digital","height":3004359,"workers":1901,"shares":166,"hashrate":0,"estimate":"0.00470","24h_blocks":91,"24h_btc":0.00331413,"lastblock":3004346,"timesincelast":2911}, "DGC-Scrypt":{"algo":"scrypt","port":3433,"name":"Digital","height":3004359,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.67392","24h_blocks":31,"24h_btc":0.00112773,"lastblock":3004287,"timesincelast":4242,"symbol":"DGC"}, "DGC-sha":{"algo":"sha256","port":3333,"name":"Digital","height":3004359,"workers":783,"shares":43,"hashrate":8942996534173,"estimate":"109.69155","24h_blocks":99,"24h_btc":0.00360473,"lastblock":3004349,"timesincelast":2877,"symbol":"DGC"}, "DNR":{"algo":"tribus","port":8533,"name":"Denarius","height":500022,"workers":707,"shares":3619,"hashrate":10847781720,"estimate":"0.02874","24h_blocks":179,"24h_btc":0.1105458,"lastblock":499974,"timesincelast":2227}, "DOGE":{"algo":"scrypt","port":3433,"name":"Doge","height":2048545,"workers":2001,"shares":55,"hashrate":0,"estimate":"0.14035","24h_blocks":6,"24h_btc":0.04773965,"lastblock":2048446,"timesincelast":6580}, "EBG":{"algo":"sha256","port":3333,"name":"Embargo","height":72318,"workers":783,"shares":33,"hashrate":0,"estimate":"39.54609","24h_blocks":0,"24h_btc":0,"lastblock":72317,"timesincelast":273654}, "EDDIE":{"algo":"scrypt","port":3433,"name":"Eddie","height":61967,"workers":1986,"shares":55,"hashrate":0,"estimate":"1.38796","24h_blocks":1,"24h_btc":0.00014028,"lastblock":61632,"timesincelast":62063}, "EFL":{"algo":"scrypt","port":3433,"name":"eGulden","height":1026017,"workers":1987,"shares":55,"hashrate":0,"estimate":"2.89162","24h_blocks":110,"24h_btc":0.00547052,"lastblock":1025997,"timesincelast":1888}, "ELM":{"algo":"x11","port":3533,"name":"Elements","height":31792,"workers":1900,"shares":166,"hashrate":0,"estimate":"0.03187","24h_blocks":1,"24h_btc":0.00021316,"lastblock":31782,"timesincelast":35272}, "EMD":{"algo":"scrypt","port":3433,"name":"Emerald","height":6322516,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.09056","24h_blocks":40,"24h_btc":1.404e-5,"lastblock":6322407,"timesincelast":2719}, "ERY":{"algo":"x11","port":3533,"name":"Eryllium","height":115063,"workers":1900,"shares":166,"hashrate":0,"estimate":"0.02247","24h_blocks":6,"24h_btc":0.00408929,"lastblock":114951,"timesincelast":24014}, "EVO":{"algo":"sha256","port":3333,"name":"Evotion","height":1391319,"workers":783,"shares":73,"hashrate":48854317299195,"estimate":"181.96574","24h_blocks":347,"24h_btc":0.00286394,"lastblock":1391308,"timesincelast":2254}, "FIDGT":{"algo":"x11","port":3533,"name":"Fidget","height":645443,"workers":1900,"shares":230,"hashrate":53126746849,"estimate":"0.04505","24h_blocks":941,"24h_btc":0.0007417,"lastblock":645390,"timesincelast":1878}, "FLAX":{"algo":"c11","port":3573,"name":"Flaxscript","height":567348,"workers":118,"shares":6,"hashrate":0,"estimate":"0.00516","24h_blocks":30,"24h_btc":7.27e-5,"lastblock":567329,"timesincelast":46401}, "FLO":{"algo":"scrypt","port":3433,"name":"Florin","height":2538733,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.28979","24h_blocks":15,"24h_btc":0.0035663,"lastblock":2538162,"timesincelast":30269}, "FRN":{"algo":"scrypt","port":3433,"name":"Francs","height":206535,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.21611","24h_blocks":0,"24h_btc":0,"lastblock":206149,"timesincelast":119404}, "FTC":{"algo":"neoscrypt","port":4233,"name":"Feather","height":2042315,"workers":1707,"shares":4870,"hashrate":1114131312,"estimate":"0.44034","24h_blocks":58,"24h_btc":0.07454358,"lastblock":2042289,"timesincelast":2806}, "GAME":{"algo":"scrypt","port":3433,"name":"GameCredits","height":1882879,"workers":1985,"shares":2770,"hashrate":130262978379,"estimate":"2.25128","24h_blocks":9,"24h_btc":0.04122612,"lastblock":1882841,"timesincelast":4260}, "GBX":{"algo":"neoscrypt","port":4233,"name":"GoByte","height":29730,"workers":1772,"shares":1948,"hashrate":570136409,"estimate":"0.38606","24h_blocks":34,"24h_btc":0.63695615,"lastblock":29707,"timesincelast":4158}, "GEERT":{"algo":"scrypt","port":3433,"name":"Geert","height":71635,"workers":1985,"shares":55,"hashrate":0,"estimate":"0.86026","24h_blocks":0,"24h_btc":0,"lastblock":71260,"timesincelast":92625}, "GEO":{"algo":"qubit","port":4733,"name":"Geo","height":1545651,"workers":182,"shares":1750,"hashrate":277663118738,"estimate":"0.50948","24h_blocks":102,"24h_btc":0.05864358,"lastblock":1545642,"timesincelast":2316}, "GRS":{"algo":"groestl","port":5333,"name":"Groestl","height":1916607,"workers":20,"shares":10194,"hashrate":49334383,"estimate":"0.00327","24h_blocks":1,"24h_btc":0.00044908,"lastblock":1916377,"timesincelast":15023}, "GUN":{"algo":"neoscrypt","port":4233,"name":"Gun","height":829127,"workers":1701,"shares":76,"hashrate":0,"estimate":"0.30608","24h_blocks":61,"24h_btc":0.01208362,"lastblock":829065,"timesincelast":8629}, "HAL":{"algo":"neoscrypt","port":4233,"name":"Halcyon","height":985185,"workers":1788,"shares":76,"hashrate":0,"estimate":"0.07457","24h_blocks":30,"24h_btc":0.00438275,"lastblock":984779,"timesincelast":24295}, "HBC":{"algo":"x11","port":3533,"name":"Homeblock","height":17438,"workers":1902,"shares":168,"hashrate":0,"estimate":"0.01868","24h_blocks":44,"24h_btc":0.16591596,"lastblock":17431,"timesincelast":1810}, "HOLD":{"algo":"scrypt","port":3433,"name":"Interstellar","height":42383,"workers":1985,"shares":55,"hashrate":0,"estimate":"1.69126","24h_blocks":62,"24h_btc":0.02879664,"lastblock":42373,"timesincelast":2568}, "HPC":{"algo":"x11","port":3533,"name":"Happy","height":81455,"workers":1900,"shares":168,"hashrate":0,"estimate":"0.02319","24h_blocks":14,"24h_btc":0.01156791,"lastblock":81436,"timesincelast":3348}, "HSR":{"algo":"hsr","port":7433,"name":"Hshare","height":407171,"workers":6,"shares":8945,"hashrate":130563341,"estimate":"0.01319","24h_blocks":0,"24h_btc":0,"lastblock":404552,"timesincelast":89142}, "HUSH":{"algo":"equihash","port":2142,"name":"Hush","height":237707,"workers":554,"shares":1460,"hashrate":138820,"estimate":"0.84459","24h_blocks":11,"24h_btc":0.10865785,"lastblock":237623,"timesincelast":13002}, "I0C":{"algo":"sha256","port":3333,"name":"I0","height":2347961,"workers":783,"shares":33,"hashrate":0,"estimate":"0.00018","24h_blocks":1,"24h_btc":3.7e-7,"lastblock":2347252,"timesincelast":62659}, "IN":{"algo":"x11","port":3533,"name":"In","height":60171,"workers":1900,"shares":168,"hashrate":0,"estimate":"0.01703","24h_blocks":0,"24h_btc":0,"lastblock":59653,"timesincelast":283063}, "INFX":{"algo":"x11","port":3533,"name":"Influx","height":458590,"workers":1907,"shares":168,"hashrate":0,"estimate":"0.02988","24h_blocks":17,"24h_btc":0.00787075,"lastblock":458368,"timesincelast":28550}, "INN":{"algo":"neoscrypt","port":4233,"name":"Innova","height":56378,"workers":1754,"shares":7201,"hashrate":1871400228,"estimate":"0.30989","24h_blocks":77,"24h_btc":0.48692046,"lastblock":56332,"timesincelast":5796}, "IRL":{"algo":"scrypt","port":3433,"name":"Irish","height":381749,"workers":1985,"shares":55,"hashrate":0,"estimate":"1.45677","24h_blocks":6,"24h_btc":0.0011188,"lastblock":381747,"timesincelast":71448}, "KASH":{"algo":"x11","port":3533,"name":"Kash","height":27944,"workers":1901,"shares":168,"hashrate":0,"estimate":"0.02202","24h_blocks":30,"24h_btc":0.01022405,"lastblock":27944,"timesincelast":25421}, "KMD":{"algo":"equihash","port":2142,"name":"Komodo","height":660680,"workers":552,"shares":1687,"hashrate":154825,"estimate":"0.29661","24h_blocks":45,"24h_btc":0.06898167,"lastblock":660649,"timesincelast":2277}, "KRONE":{"algo":"scrypt","port":3433,"name":"Krone","height":85003,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.15797","24h_blocks":23,"24h_btc":0.01013512,"lastblock":84951,"timesincelast":16797}, "LBC":{"algo":"lbry","port":3334,"name":"LBRY.io","height":303267,"workers":150,"shares":124185,"hashrate":34464650102,"estimate":"0.00072","24h_blocks":0,"24h_btc":0,"lastblock":302617,"timesincelast":104682}, "LCP":{"algo":"scrypt","port":3433,"name":"LitePlus","height":767688,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.22148","24h_blocks":159,"24h_btc":0.02171862,"lastblock":767562,"timesincelast":1924}, "LINDA":{"algo":"scrypt","port":3433,"name":"Linda","height":268940,"workers":1992,"shares":13447,"hashrate":779663421100,"estimate":"5.49584","24h_blocks":62,"24h_btc":0.36734272,"lastblock":268900,"timesincelast":2792}, "LINX":{"algo":"scrypt","port":3433,"name":"LinX","height":298376,"workers":1989,"shares":55,"hashrate":0,"estimate":"2.34953","24h_blocks":97,"24h_btc":0.21735583,"lastblock":298319,"timesincelast":4046}, "LIT":{"algo":"blakecoin","port":5743,"name":"Lithium","height":544795,"workers":14,"shares":0,"hashrate":0,"estimate":"0.01174","24h_blocks":1,"24h_btc":1.86e-5,"lastblock":544491,"timesincelast":56993}, "LTB":{"algo":"scrypt","port":3433,"name":"LiteBar","height":409464,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.18609","24h_blocks":103,"24h_btc":0.01837754,"lastblock":409464,"timesincelast":4869}, "LTC":{"algo":"scrypt","port":3433,"name":"Litecoin","height":1348139,"workers":2215,"shares":55,"hashrate":0,"estimate":"2.50954","24h_blocks":0,"24h_btc":0,"lastblock":1343640,"timesincelast":691244}, "LTCU":{"algo":"scrypt","port":3433,"name":"LiteUltra","height":14567,"workers":1985,"shares":55,"hashrate":0,"estimate":"1.39228","24h_blocks":3,"24h_btc":0.00229246,"lastblock":14542,"timesincelast":52725}, "LUX":{"algo":"phi","port":8333,"name":"Lux","height":141645,"workers":88,"shares":28010,"hashrate":16668420355,"estimate":"0.02356","24h_blocks":14,"24h_btc":0.27630709,"lastblock":141591,"timesincelast":4257}, "MAC":{"algo":"timetravel","port":3555,"name":"Machine","height":463315,"workers":8,"shares":1492,"hashrate":43679785,"estimate":"0.00906","24h_blocks":42,"24h_btc":0.00888837,"lastblock":463306,"timesincelast":8249}, "MAR":{"algo":"x11","port":3533,"name":"Marijuana","height":1020962,"workers":1900,"shares":168,"hashrate":0,"estimate":"0.01227","24h_blocks":8,"24h_btc":0.00033815,"lastblock":1020883,"timesincelast":2936}, "MARS":{"algo":"scrypt","port":3433,"name":"Mars","height":826302,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.53875","24h_blocks":60,"24h_btc":0.00176007,"lastblock":826301,"timesincelast":1866}, "MATRX":{"algo":"scrypt","port":3433,"name":"Matrix","height":32968,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.20316","24h_blocks":0,"24h_btc":0,"lastblock":18870,"timesincelast":5398328}, "MAX":{"algo":"keccak","port":5133,"name":"Max","height":2347854,"workers":145,"shares":1302,"hashrate":108539435661,"estimate":"0.23395","24h_blocks":1232,"24h_btc":0.02097539,"lastblock":2347833,"timesincelast":1830}, "MAY":{"algo":"sha256","port":3333,"name":"May","height":102444,"workers":783,"shares":33,"hashrate":0,"estimate":"123.33172","24h_blocks":20,"24h_btc":0.0046386,"lastblock":102418,"timesincelast":11562}, "MEC":{"algo":"scrypt","port":3433,"name":"Mega","height":934636,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.34817","24h_blocks":17,"24h_btc":0.00160049,"lastblock":934623,"timesincelast":1791}, "MGT":{"algo":"skunk","port":8433,"name":"Magnatum","height":194678,"workers":57,"shares":6,"hashrate":0,"estimate":"0.00167","24h_blocks":0,"24h_btc":0,"lastblock":190374,"timesincelast":272460}, "MONA":{"algo":"lyra2v2","port":4533,"name":"Mona","height":1214062,"workers":291,"shares":35,"hashrate":0,"estimate":"0.00568","24h_blocks":30,"24h_btc":0.37276237,"lastblock":1214047,"timesincelast":1915}, "MONK":{"algo":"x11","port":3533,"name":"Monkey","height":27906,"workers":1900,"shares":168,"hashrate":0,"estimate":"0.02255","24h_blocks":71,"24h_btc":0.08105092,"lastblock":27895,"timesincelast":2589}, "MUE":{"algo":"x11","port":3533,"name":"MonetaryUnit","height":351043,"workers":1916,"shares":168,"hashrate":0,"estimate":"0.05582","24h_blocks":155,"24h_btc":0.07412602,"lastblock":350993,"timesincelast":2791}, "MZC":{"algo":"sha256","port":3333,"name":"Maza","height":971874,"workers":786,"shares":353,"hashrate":5.1954918203287e+14,"estimate":"114.13129","24h_blocks":162,"24h_btc":0.05084892,"lastblock":971869,"timesincelast":1866}, "NEVA":{"algo":"blake2s","port":5766,"name":"Neva","height":506164,"workers":291,"shares":133,"hashrate":0,"estimate":"0.02918","24h_blocks":26,"24h_btc":0.00182898,"lastblock":506150,"timesincelast":2712}, "NKC":{"algo":"sha256","port":3333,"name":"Nuke","height":392794,"workers":783,"shares":33,"hashrate":0,"estimate":"146.63774","24h_blocks":78,"24h_btc":0.00019782,"lastblock":392781,"timesincelast":2625}, "NLG":{"algo":"scrypt","port":3433,"name":"Gulden","height":665930,"workers":1986,"shares":55,"hashrate":0,"estimate":"1.80800","24h_blocks":121,"24h_btc":0.22928444,"lastblock":665920,"timesincelast":2240}, "NMS":{"algo":"skein","port":4933,"name":"Numus ","height":63782,"workers":531,"shares":7149,"hashrate":539301712774,"estimate":"0.00035","24h_blocks":77,"24h_btc":0.31865624,"lastblock":63733,"timesincelast":2045}, "NOTE":{"algo":"scrypt","port":3433,"name":"Dnotes","height":2044039,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.32319","24h_blocks":19,"24h_btc":0.00300564,"lastblock":2043543,"timesincelast":29866}, "NVC":{"algo":"scrypt","port":3433,"name":"Nova","height":392476,"workers":1986,"shares":55,"hashrate":0,"estimate":"2.48745","24h_blocks":0,"24h_btc":0,"lastblock":391390,"timesincelast":447649}, "ONION":{"algo":"x13","port":3633,"name":"DeepOnion","height":308129,"workers":97,"shares":20504,"hashrate":69500687078,"estimate":"0.00096","24h_blocks":9,"24h_btc":0.0686165,"lastblock":307552,"timesincelast":28061}, "ONX":{"algo":"x11","port":3533,"name":"Onix","height":122077,"workers":1913,"shares":168,"hashrate":0,"estimate":"0.03511","24h_blocks":82,"24h_btc":0.01725363,"lastblock":122075,"timesincelast":2709}, "OOO":{"algo":"sha256","port":3333,"name":"Om","height":29485,"workers":783,"shares":33,"hashrate":0,"estimate":"68.83938","24h_blocks":2,"24h_btc":0.00071225,"lastblock":29485,"timesincelast":67118}, "ORB":{"algo":"neoscrypt","port":4233,"name":"Orbit","height":2342966,"workers":1692,"shares":538,"hashrate":86322106,"estimate":"0.33766","24h_blocks":20,"24h_btc":0.00101406,"lastblock":2342946,"timesincelast":3750}, "PAK":{"algo":"scrypt","port":3433,"name":"Pak","height":565947,"workers":1985,"shares":55,"hashrate":0,"estimate":"2.79890","24h_blocks":58,"24h_btc":0.00663338,"lastblock":565880,"timesincelast":8057}, "PINK":{"algo":"scrypt","port":3433,"name":"Pink","height":334078,"workers":1987,"shares":39,"hashrate":0,"estimate":"2.26202","24h_blocks":8,"24h_btc":0.00220905,"lastblock":333803,"timesincelast":20206}, "PIZZA":{"algo":"x11","port":3533,"name":"PiZZA","height":362805,"workers":1900,"shares":168,"hashrate":0,"estimate":"0.00016","24h_blocks":0,"24h_btc":0,"lastblock":335794,"timesincelast":2340838}, "PLC":{"algo":"sha256","port":3333,"name":"Pol","height":1356505,"workers":783,"shares":231,"hashrate":2.0711582582986e+14,"estimate":"138.19631","24h_blocks":86,"24h_btc":0.00208287,"lastblock":1356457,"timesincelast":4336}, "PLYS":{"algo":"polytimos","port":8463,"name":"Polytimos","height":25863,"workers":28,"shares":243,"hashrate":631889332,"estimate":"0.00806","24h_blocks":46,"24h_btc":0.00675,"lastblock":25854,"timesincelast":1907}, "PPC":{"algo":"sha256","port":3333,"name":"Peer","height":343452,"workers":786,"shares":924,"hashrate":1.6007241534437e+15,"estimate":"157.65622","24h_blocks":17,"24h_btc":0.31552522,"lastblock":343435,"timesincelast":9220}, "PUT":{"algo":"scrypt","port":3433,"name":"Putin","height":41330,"workers":1985,"shares":39,"hashrate":0,"estimate":"1.40200","24h_blocks":0,"24h_btc":0,"lastblock":40530,"timesincelast":552157}, "PXC":{"algo":"neoscrypt","port":4233,"name":"Phoenix","height":1612155,"workers":1693,"shares":95,"hashrate":2474966,"estimate":"0.31759","24h_blocks":31,"24h_btc":0.00154776,"lastblock":1612125,"timesincelast":3745}, "QRK":{"algo":"quark","port":4033,"name":"Quark","height":5146450,"workers":56,"shares":226,"hashrate":48602003625,"estimate":"0.20150","24h_blocks":1981,"24h_btc":0.00593978,"lastblock":5146412,"timesincelast":1806}, "QTL":{"algo":"scrypt","port":3433,"name":"Quatloo","height":637842,"workers":1985,"shares":93,"hashrate":2622546975,"estimate":"1.26482","24h_blocks":90,"24h_btc":0.00251383,"lastblock":637836,"timesincelast":4599}, "RED":{"algo":"scrypt","port":3433,"name":"RedCoin","height":900307,"workers":1985,"shares":39,"hashrate":0,"estimate":"1.64415","24h_blocks":0,"24h_btc":0,"lastblock":899612,"timesincelast":119092}, "RGC":{"algo":"nist5","port":3833,"name":"RG","height":7610,"workers":1356,"shares":312,"hashrate":0,"estimate":"0.00000","24h_blocks":0,"24h_btc":0,"lastblock":5253,"timesincelast":354051}, "RUP":{"algo":"scrypt","port":3433,"name":"Rupee","height":36694,"workers":1987,"shares":39,"hashrate":0,"estimate":"1.82742","24h_blocks":54,"24h_btc":0.12440984,"lastblock":36691,"timesincelast":6267}, "SAK":{"algo":"quark","port":4033,"name":"Shark","height":5409340,"workers":56,"shares":30,"hashrate":5597530751,"estimate":"0.10122","24h_blocks":1047,"24h_btc":0.00137155,"lastblock":5409331,"timesincelast":2276}, "SAND":{"algo":"x11","port":3533,"name":"Beach","height":83576,"workers":1900,"shares":1118,"hashrate":1777001768492,"estimate":"0.03934","24h_blocks":155,"24h_btc":0.01553069,"lastblock":83560,"timesincelast":3410}, "SFC":{"algo":"scrypt","port":3433,"name":"Solarflare","height":95894,"workers":1985,"shares":39,"hashrate":0,"estimate":"2.30814","24h_blocks":43,"24h_btc":0.00343725,"lastblock":95893,"timesincelast":1930}, "SIB":{"algo":"sib","port":5033,"name":"Sib","height":536030,"workers":102,"shares":3127,"hashrate":747638587,"estimate":"0.03248","24h_blocks":24,"24h_btc":0.03422603,"lastblock":536020,"timesincelast":2648}, "SMC":{"algo":"x11","port":3533,"name":"Smart","height":966464,"workers":1901,"shares":168,"hashrate":0,"estimate":"0.03513","24h_blocks":89,"24h_btc":0.00765866,"lastblock":966444,"timesincelast":3326}, "SONG":{"algo":"scrypt","port":3433,"name":"Song","height":529255,"workers":1985,"shares":39,"hashrate":0,"estimate":"2.62229","24h_blocks":199,"24h_btc":0.02035106,"lastblock":529212,"timesincelast":1792}, "SOON":{"algo":"sha256","port":3333,"name":"Soon","height":551985,"workers":783,"shares":34,"hashrate":2273808598617,"estimate":"139.86424","24h_blocks":153,"24h_btc":0.00441539,"lastblock":551983,"timesincelast":1809}, "SPACE":{"algo":"scrypt","port":3433,"name":"Space","height":1117862,"workers":1985,"shares":39,"hashrate":0,"estimate":"1.03299","24h_blocks":0,"24h_btc":0,"lastblock":1113104,"timesincelast":548343}, "START":{"algo":"x11","port":3533,"name":"Start","height":1480425,"workers":1910,"shares":168,"hashrate":0,"estimate":"0.01527","24h_blocks":55,"24h_btc":0.01396732,"lastblock":1480362,"timesincelast":4193}, "SXC":{"algo":"scrypt","port":3433,"name":"Sex","height":2572433,"workers":1995,"shares":39,"hashrate":0,"estimate":"2.05642","24h_blocks":88,"24h_btc":0.00469136,"lastblock":2572190,"timesincelast":11267}, "TAJ":{"algo":"blake2s","port":5766,"name":"Taj","height":146842,"workers":291,"shares":133,"hashrate":0,"estimate":"0.02376","24h_blocks":12,"24h_btc":0.00361778,"lastblock":146839,"timesincelast":21105}, "THC":{"algo":"scrypt","port":3433,"name":"Hemp","height":2009967,"workers":1985,"shares":39,"hashrate":0,"estimate":"2.15963","24h_blocks":228,"24h_btc":0.06846047,"lastblock":2009939,"timesincelast":1806}, "TIT":{"algo":"sha256","port":3333,"name":"Tit","height":1428994,"workers":783,"shares":25,"hashrate":0,"estimate":"126.73464","24h_blocks":76,"24h_btc":0.00294897,"lastblock":1428965,"timesincelast":2337}, "UIS":{"algo":"yescrypt","port":6233,"name":"Unitus","height":1259465,"workers":18123,"shares":623,"hashrate":0,"estimate":"0.00684","24h_blocks":154,"24h_btc":0.02472949,"lastblock":1259446,"timesincelast":1905}, "UIS-lyra":{"algo":"lyra2v2","port":4533,"name":"Unitus","height":1259465,"workers":283,"shares":35,"hashrate":0,"estimate":"0.00022","24h_blocks":103,"24h_btc":0.01653758,"lastblock":1259447,"timesincelast":1889,"symbol":"UIS"}, "UIS-skein":{"algo":"skein","port":4933,"name":"Unitus","height":1259466,"workers":531,"shares":2,"hashrate":0,"estimate":"0.00002","24h_blocks":38,"24h_btc":0.00609881,"lastblock":1259406,"timesincelast":4790,"symbol":"UIS"}, "UIS-x11":{"algo":"x11","port":3533,"name":"Unitus","height":1259465,"workers":1902,"shares":168,"hashrate":0,"estimate":"0.00016","24h_blocks":18,"24h_btc":0.00286193,"lastblock":1259429,"timesincelast":3003,"symbol":"UIS"}, "UNB":{"algo":"sha256","port":3333,"name":"Unbreakable","height":82670,"workers":784,"shares":25,"hashrate":0,"estimate":"59.18278","24h_blocks":0,"24h_btc":0,"lastblock":82655,"timesincelast":1241551}, "UNIC":{"algo":"sha256","port":3333,"name":"Uni","height":1268830,"workers":783,"shares":25,"hashrate":0,"estimate":"105.28031","24h_blocks":2,"24h_btc":4.481e-5,"lastblock":1268829,"timesincelast":73780}, "VIA":{"algo":"scrypt","port":3433,"name":"Via","height":4548396,"workers":1985,"shares":39,"hashrate":0,"estimate":"0.01238","24h_blocks":25,"24h_btc":0.00301281,"lastblock":4548212,"timesincelast":4901}, "VLT":{"algo":"veltor","port":5034,"name":"Veltor","height":23447,"workers":90,"shares":990,"hashrate":8954422697,"estimate":"0.00637","24h_blocks":54,"24h_btc":0.06091955,"lastblock":23446,"timesincelast":1990}, "VLTC":{"algo":"x11","port":3533,"name":"Vault","height":170756,"workers":1902,"shares":168,"hashrate":0,"estimate":"0.01647","24h_blocks":0,"24h_btc":0,"lastblock":170475,"timesincelast":203791}, "VTC":{"algo":"lyra2v2","port":4533,"name":"Vert","height":857088,"workers":296,"shares":7712,"hashrate":98276180740,"estimate":"0.00711","24h_blocks":31,"24h_btc":0.29665542,"lastblock":857067,"timesincelast":2862}, "WDC":{"algo":"scrypt","port":3433,"name":"World","height":3567985,"workers":1985,"shares":39,"hashrate":0,"estimate":"2.23520","24h_blocks":0,"24h_btc":0,"lastblock":3567359,"timesincelast":102183}, "XCT":{"algo":"sha256","port":3333,"name":"C-Bit","height":496954,"workers":787,"shares":25,"hashrate":0,"estimate":"117.38739","24h_blocks":27,"24h_btc":0.00189125,"lastblock":496953,"timesincelast":2478}, "XGOX":{"algo":"scrypt","port":3433,"name":"Go","height":163626,"workers":1986,"shares":39,"hashrate":0,"estimate":"1.52702","24h_blocks":0,"24h_btc":0,"lastblock":162062,"timesincelast":170463}, "XJO":{"algo":"sha256","port":3333,"name":"Joule","height":3076642,"workers":783,"shares":112,"hashrate":90389936774960,"estimate":"141.96911","24h_blocks":355,"24h_btc":0.00456171,"lastblock":3076586,"timesincelast":2317}, "XMCC":{"algo":"x11","port":3533,"name":"Monaco","height":125460,"workers":1909,"shares":168,"hashrate":0,"estimate":"0.02580","24h_blocks":49,"24h_btc":0.09028605,"lastblock":125433,"timesincelast":4534}, "XMG":{"algo":"m7m","port":6033,"name":"Magi","height":1610881,"workers":324,"shares":36290,"hashrate":8222031,"estimate":"0.19868","24h_blocks":4,"24h_btc":0.00016653,"lastblock":1610838,"timesincelast":5386}, "XMY":{"algo":"yescrypt","port":6233,"name":"Myriad","height":2303141,"workers":18164,"shares":25790,"hashrate":6482546,"estimate":"0.02947","24h_blocks":134,"24h_btc":0.08130133,"lastblock":2303131,"timesincelast":1891}, "XMY-Groestl":{"algo":"myr-gr","port":5433,"name":"Myriad","height":2303141,"workers":21,"shares":142,"hashrate":114711822041,"estimate":"0.00036","24h_blocks":126,"24h_btc":0.07475437,"lastblock":2303127,"timesincelast":2146,"symbol":"XMY"}, "XMY-Scrypt":{"algo":"scrypt","port":3433,"name":"Myriad","height":2303141,"workers":1985,"shares":39,"hashrate":0,"estimate":"0.00781","24h_blocks":3,"24h_btc":0.00185335,"lastblock":2303050,"timesincelast":8560,"symbol":"XMY"}, "XMY-sha":{"algo":"sha256","port":3333,"name":"Myriad","height":2303141,"workers":783,"shares":25,"hashrate":0,"estimate":"0.08842","24h_blocks":0,"24h_btc":0,"lastblock":2297332,"timesincelast":502879,"symbol":"XMY"}, "XMY-skein":{"algo":"skein","port":4933,"name":"Myriad","height":2303143,"workers":531,"shares":400,"hashrate":28173234565,"estimate":"0.00043","24h_blocks":8,"24h_btc":0.00510584,"lastblock":2302897,"timesincelast":17940,"symbol":"XMY"}, "XPTX":{"algo":"quark","port":4033,"name":"PlatinumBar","height":609891,"workers":57,"shares":46,"hashrate":9957306288,"estimate":"0.07676","24h_blocks":155,"24h_btc":0.00030852,"lastblock":609866,"timesincelast":2206}, "XRE":{"algo":"x11evo","port":3553,"name":"Revolver","height":843614,"workers":9,"shares":72,"hashrate":146454949,"estimate":"0.01384","24h_blocks":583,"24h_btc":0.00315168,"lastblock":843597,"timesincelast":1809}, "XVG":{"algo":"scrypt","port":3433,"name":"Verge","height":1790838,"workers":2143,"shares":39,"hashrate":0,"estimate":"2.66749","24h_blocks":23,"24h_btc":0.39292744,"lastblock":1790551,"timesincelast":10235}, "XVG-blake2s":{"algo":"blake2s","port":5766,"name":"Verge","height":1790838,"workers":289,"shares":11571,"hashrate":1030198414761,"estimate":"0.03569","24h_blocks":18,"24h_btc":0.30710158,"lastblock":1790606,"timesincelast":8393,"symbol":"XVG"}, "XVG-groestl":{"algo":"myr-gr","port":5433,"name":"Verge","height":1790838,"workers":21,"shares":151,"hashrate":124527520734,"estimate":"0.00069","24h_blocks":1,"24h_btc":0.01689829,"lastblock":1788762,"timesincelast":70256,"symbol":"XVG"}, "XVG-lyra":{"algo":"lyra2v2","port":4533,"name":"Verge","height":1790838,"workers":282,"shares":35,"hashrate":0,"estimate":"0.00691","24h_blocks":14,"24h_btc":0.23873284,"lastblock":1790415,"timesincelast":14891,"symbol":"XVG"}, "XVG-x17":{"algo":"x17","port":3737,"name":"Verge","height":1790838,"workers":836,"shares":19833,"hashrate":68659780585,"estimate":"0.04021","24h_blocks":173,"24h_btc":2.86814133,"lastblock":1790801,"timesincelast":1903,"symbol":"XVG"}, "ZCL":{"algo":"equihash","port":2142,"name":"Zclassic","height":245262,"workers":563,"shares":1557,"hashrate":141464,"estimate":"0.80763","24h_blocks":1,"24h_btc":0.13084944,"lastblock":245201,"timesincelast":10219}, "ZSE":{"algo":"x11","port":3533,"name":"ZSEcoin","height":190553,"workers":1902,"shares":168,"hashrate":0,"estimate":"0.02664","24h_blocks":14,"24h_btc":0.00072849,"lastblock":190505,"timesincelast":16326}, "ZYD":{"algo":"sha256","port":3333,"name":"Zayed","height":353394,"workers":783,"shares":25,"hashrate":0,"estimate":"4.77579","24h_blocks":0,"24h_btc":0,"lastblock":350847,"timesincelast":355627}}')  # NOQA

    def _get_algo_api_resp(self):
        return loads('{"bitcore":{"name":"bitcore","port":3556,"coins":1,"fees":2,"hashrate":438015057,"workers":23,"estimate_current":"0.00002311","estimate_last24h":"0.00002395","actual_last24h":"0.00000","hashrate_last24h":264911745.9053},"blake2s":{"name":"blake2s","port":5766,"coins":3,"fees":2,"hashrate":1030198414761,"workers":431,"estimate_current":"0.00003498","estimate_last24h":"0.00008348","actual_last24h":"0.06135","hashrate_last24h":5094435819068.4},"blakecoin":{"name":"blakecoin","port":5743,"coins":2,"fees":2,"hashrate":40755231003,"workers":20,"estimate_current":"0.00005131","estimate_last24h":"0.00005578","actual_last24h":"0.05026","hashrate_last24h":67100455508.968},"c11":{"name":"c11","port":3573,"coins":2,"fees":2,"hashrate":3566727760,"workers":126,"estimate_current":"0.00002384","estimate_last24h":"0.00002092","actual_last24h":"0.02530","hashrate_last24h":2564900911.4},"equihash":{"name":"equihash","port":2142,"coins":3,"fees":1.75,"hashrate":435109.412,"workers":602,"estimate_current":"0.00066756","estimate_last24h":"0.00061579","actual_last24h":"0.64111","hashrate_last24h":481182.9385684},"groestl":{"name":"groestl","port":5333,"coins":1,"fees":2,"hashrate":49334383,"workers":27,"estimate_current":"0.00000320","estimate_last24h":"0.00000431","actual_last24h":"0.00227","hashrate_last24h":197704261.1684},"hsr":{"name":"hsr","port":7433,"coins":1,"fees":2,"hashrate":130563341,"workers":8,"estimate_current":"0.00001293","estimate_last24h":"0.00002230","actual_last24h":"0.00000","hashrate_last24h":270803464.0947},"keccak":{"name":"keccak","port":5133,"coins":1,"fees":2,"hashrate":108539435661,"workers":146,"estimate_current":"0.00022927","estimate_last24h":"0.00020645","actual_last24h":"0.19772","hashrate_last24h":106087171488.38},"lbry":{"name":"lbry","port":3334,"coins":1,"fees":2,"hashrate":34464650102,"workers":158,"estimate_current":"0.00000071","estimate_last24h":"0.00000077","actual_last24h":"0.00000","hashrate_last24h":56164864156.979},"lyra2v2":{"name":"lyra2v2","port":4533,"coins":4,"fees":1.75,"hashrate":98276180740,"workers":1036,"estimate_current":"0.00000698","estimate_last24h":"0.00000820","actual_last24h":"0.00907","hashrate_last24h":101967149482.52},"m7m":{"name":"m7m","port":6033,"coins":1,"fees":2,"hashrate":8222031,"workers":331,"estimate_current":"0.00019471","estimate_last24h":"74.99815068","actual_last24h":"0.21801","hashrate_last24h":763891.1474},"myr-gr":{"name":"myr-gr","port":5433,"coins":4,"fees":2,"hashrate":638493732327,"workers":76,"estimate_current":"0.00000045","estimate_last24h":"0.00000029","actual_last24h":"0.00021","hashrate_last24h":612502434827.14},"neoscrypt":{"name":"neoscrypt","port":4233,"coins":8,"fees":2,"hashrate":5948500403,"workers":2213,"estimate_current":"0.00039156","estimate_last24h":"0.00043707","actual_last24h":"0.38134","hashrate_last24h":6199783372.6842},"nist5":{"name":"nist5","port":3833,"coins":2,"fees":2,"hashrate":172423830171,"workers":1547,"estimate_current":"0.00001254","estimate_last24h":"0.00000935","actual_last24h":"0.00771","hashrate_last24h":109723708234.61},"phi":{"name":"phi","port":8333,"coins":1,"fees":2,"hashrate":16668420355,"workers":108,"estimate_current":"0.00002309","estimate_last24h":"0.00002831","actual_last24h":"0.02551","hashrate_last24h":10832531609.105},"polytimos":{"name":"polytimos","port":8463,"coins":1,"fees":2,"hashrate":631889332,"workers":28,"estimate_current":"0.00000790","estimate_last24h":"0.00000867","actual_last24h":"0.01058","hashrate_last24h":623677716.7368},"quark":{"name":"quark","port":4033,"coins":3,"fees":2,"hashrate":64156840664,"workers":61,"estimate_current":"0.00015462","estimate_last24h":"0.00012488","actual_last24h":"0.11633","hashrate_last24h":65493096898.137},"qubit":{"name":"qubit","port":4733,"coins":2,"fees":2,"hashrate":377096922791,"workers":244,"estimate_current":"0.00048334","estimate_last24h":"0.00059643","actual_last24h":"0.73789","hashrate_last24h":284260343669.12},"scrypt":{"name":"scrypt","port":3433,"coins":58,"fees":1,"hashrate":999610785990,"workers":2488,"estimate_current":"0.00513142","estimate_last24h":"0.00349644","actual_last24h":"2.32649","hashrate_last24h":898656833977.43},"sha256":{"name":"sha256","port":3333,"coins":25,"fees":1.5,"hashrate":6.16027818789e+15,"workers":811,"estimate_current":"0.15293456","estimate_last24h":"0.17001151","actual_last24h":"167.41393","hashrate_last24h":5.6812372243789e+15},"sib":{"name":"sib","port":5033,"coins":1,"fees":2,"hashrate":747638587,"workers":99,"estimate_current":"0.00003183","estimate_last24h":"0.00002489","actual_last24h":"0.03192","hashrate_last24h":1072209018.0211},"skein":{"name":"skein","port":4933,"coins":4,"fees":2,"hashrate":576208128512,"workers":581,"estimate_current":"0.00000036","estimate_last24h":"0.00000091","actual_last24h":"0.00102","hashrate_last24h":511540560761.4},"skunk":{"name":"skunk","port":8433,"coins":2,"fees":2,"hashrate":11724312389,"workers":63,"estimate_current":"0.00000822","estimate_last24h":"0.00001073","actual_last24h":"0.01045","hashrate_last24h":7654667548.1895},"timetravel":{"name":"timetravel","port":3555,"coins":1,"fees":2,"hashrate":43679785,"workers":9,"estimate_current":"0.00000888","estimate_last24h":"0.00001059","actual_last24h":"0.00802","hashrate_last24h":1108190790.3158},"tribus":{"name":"tribus","port":8533,"coins":1,"fees":2,"hashrate":10847781720,"workers":743,"estimate_current":"0.00002817","estimate_last24h":"0.00000694","actual_last24h":"0.00483","hashrate_last24h":22881970898.516},"veltor":{"name":"veltor","port":5034,"coins":1,"fees":2,"hashrate":8954422697,"workers":91,"estimate_current":"0.00000624","estimate_last24h":"0.00001162","actual_last24h":"0.01603","hashrate_last24h":3799679011.9895},"x11":{"name":"x11","port":3533,"coins":28,"fees":0.85,"hashrate":32535604597055,"workers":2628,"estimate_current":"0.00002809","estimate_last24h":"0.00003751","actual_last24h":"0.03129","hashrate_last24h":31163197115296},"x11evo":{"name":"x11evo","port":3553,"coins":1,"fees":2,"hashrate":146454949,"workers":12,"estimate_current":"0.00001357","estimate_last24h":"0.00001875","actual_last24h":"0.01725","hashrate_last24h":182668155.2},"x13":{"name":"x13","port":3633,"coins":2,"fees":2,"hashrate":69500687078,"workers":108,"estimate_current":"0.00000094","estimate_last24h":"0.00000099","actual_last24h":"0.00129","hashrate_last24h":53637718479.147},"x14":{"name":"x14","port":3933,"coins":1,"fees":2,"hashrate":9237422329,"workers":25,"estimate_current":"0.00000059","estimate_last24h":"0.00000087","actual_last24h":"0.00094","hashrate_last24h":12505309772.916},"x17":{"name":"x17","port":3737,"coins":1,"fees":2,"hashrate":68659780585,"workers":2521,"estimate_current":"0.00003941","estimate_last24h":"0.00005397","actual_last24h":"0.03996","hashrate_last24h":71360653353.821},"xevan":{"name":"xevan","port":3739,"coins":1,"fees":2,"hashrate":263969799,"workers":156,"estimate_current":"0.00005900","estimate_last24h":"0.00008449","actual_last24h":"0.08718","hashrate_last24h":301680938.6316},"yescrypt":{"name":"yescrypt","port":6233,"coins":3,"fees":2,"hashrate":6533430,"workers":18765,"estimate_current":"0.00002883","estimate_last24h":"0.00002323","actual_last24h":"0.01940","hashrate_last24h":6447940.2421}}')  # NOQA

    def _get_miner_mock(self, algo, *args, **kwargs):
        miner = MagicMock()
        rate = MagicMock()
        miner._algo = algo
        if algo == "skein":
            rate.get_mbtc_per_day = lambda x: 10.0
        elif algo == "lyra2v2":
            rate.get_mbtc_per_day = lambda x: 5.0
        else:
            rate.get_mbtc_per_day = lambda x: 0.0

        miner.benchmark = lambda: rate

        return miner

    def _fetch_json_api_mock(self, url):
        self.assertTrue("status" in url or "currencies" in url)
        if "status" in url:
            return self._get_algo_api_resp()
        elif "currencies" in url:
            return self._get_currency_api_resp()

    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.multipool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_algo(self, get_miner_for_algo, fetch_json_api):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa")
        miner = z.get_most_profitable_miner()
        fetch_json_api.assert_called_with("http://www.zpool.ca/api/status")
        self.assertEqual(miner._algo, "skein")

    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.multipool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_currency(self, get_miner_for_algo, fetch_json_api):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa", algo_data_source="currency")
        miner = z.get_most_profitable_miner()
        fetch_json_api.assert_called_with("http://www.zpool.ca/api/currencies")
        self.assertEqual(miner._algo, "skein")

    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.multipool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_algo_blacklist(self, get_miner_for_algo, fetch_json_api):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa", algo_blacklist={"skein"})
        miner = z.get_most_profitable_miner()
        self.assertEqual(miner._algo, "lyra2v2")

    @patch("speed_miner.mining_groups.zpool_mining_group.LOG.debug")
    @patch("speed_miner.mining_groups.zpool_mining_group.Fetcher.fetch_json_api")
    @patch("speed_miner.mining_groups.multipool_mining_group.get_miner_for_algo")
    def test_get_most_profitable_miner_calc_all_algo_data_sources(
            self, get_miner_for_algo, fetch_json_api, debug):
        get_miner_for_algo.side_effect = self._get_miner_mock
        fetch_json_api.side_effect = self._fetch_json_api_mock
        z = ZPoolMiningGroup("BTC", "fdsafdsafdsa", calc_all_algo_data_sources=True)
        miner = z.get_most_profitable_miner()
        fetch_json_api.assert_has_calls(
            [call("http://www.zpool.ca/api/currencies"), call("http://www.zpool.ca/api/status")])
        self.assertEqual(miner._algo, "skein")

        good_logs = ["Switching to source", "Loading benchmarks", "Reverting to source"]
        logs = [c[0][0] for c in debug.call_args_list if any(l in c[0][0] for l in good_logs)]
        self.assertIn("currency", logs[0])
        self.assertIn("Loading benchmarks from cache", logs[1])
        self.assertIn("algo", logs[2])
        self.assertIn("Loading benchmarks from cache", logs[3])
